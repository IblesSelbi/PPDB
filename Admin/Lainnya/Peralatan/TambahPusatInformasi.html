<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Tambah Informasi :: Akeno PPDB System</title>

    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body style="font-family: 'Inter', sans-serif; background-color: #f5f5f5;">

    <!-- NAVBAR -->
    <div id="navbar"></div>

    <!-- MAIN CONTENT -->
    <div class="container-fluid py-4">

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb bg-white px-3 mb-2">
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none">Beranda</a></li>
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none">Lainnya</a></li>
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none">Pusat Informasi</a></li>
                <li class="breadcrumb-item active">Tambah Informasi</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
                <div>
                    <h2 class="font-weight-bold mb-1">Tambah Informasi</h2>
                    <p class="text-muted mb-0"><i class="fas fa-info-circle mr-1"></i>Tambahkan informasi baru untuk
                        sekolah</p>
                </div>
                <div class="mt-2 mt-md-0 mr-2">
                    <a href="PusatInformasi.html" class="btn btn-outline-primary px-3">
                        <i class="fas fa-arrow-left mr-1"></i>Kembali
                    </a>
                </div>
            </div>
        </div>

        <!-- Alert -->
        <div id="alert" class="alert alert-dismissible fade" role="alert" style="display: none;">
            <div class="d-flex align-items-center">
                <div class="mr-3">
                    <i id="alert-icon" class="fas fa-info-circle fa-2x text-primary"></i>
                </div>
                <div class="flex-grow-1">
                    <h6 id="alert-title" class="alert-heading font-weight-bold mb-1">Informasi</h6>
                    <div id="alert-content" class="mb-0"></div>
                </div>
            </div>
            <button type="button" class="close" onclick="hideAlert()">
                <span>&times;</span>
            </button>
        </div>

        <!-- Form Card -->
        <form id="form-information">

            <div class="row">

                <!-- KOLOM KIRI -->
                <div class="col-lg-6 mb-4">
                    <div class="card">
                        <div class="card-body p-4">

                            <h5 class="font-weight-bold mb-4">
                                <i class="fas fa-edit text-primary mr-2"></i>Informasi Utama
                            </h5>

                            <div class="form-group">
                                <label class="font-weight-bold">Judul Informasi <span
                                        class="text-danger">*</span></label>
                                <input type="text" id="info-title" class="form-control"
                                    placeholder="Masukan judul informasi" maxlength="120">
                                <small id="info-title-feedback" class="form-text text-danger"
                                    style="display:none;"></small>
                            </div>

                            <div class="form-group">
                                <label class="font-weight-bold">Isi Konten <span class="text-danger">*</span></label>
                                <textarea id="info-content" class="form-control" rows="10"
                                    placeholder="Masukan isi konten informasi..."></textarea>
                                <small id="info-content-feedback" class="form-text text-danger"
                                    style="display:none;"></small>
                            </div>

                            <div class="form-group">
                                <label class="font-weight-bold">Gambar Sampul</label>
                                <div class="custom-file">
                                    <input type="file" class="custom-file-input" id="info-thumbnail" accept="image/*">
                                    <label class="custom-file-label" for="info-thumbnail">Pilih gambar...</label>
                                </div>
                                <small class="form-text text-muted">Format: JPG, PNG, WEBP. Maksimal 2MB</small>
                                <small id="info-thumbnail-feedback" class="form-text text-danger"
                                    style="display:none;"></small>
                            </div>

                            <div class="form-group">
                                <label class="font-weight-bold">Preview Gambar</label>
                                <div id="image-preview" class="border rounded p-3 text-center bg-light"
                                    style="display:none;">
                                    <img id="preview-img" src="" class="img-fluid rounded" style="max-height:300px;">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="font-weight-bold d-block">Sorot Informasi</label>
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="info-highlight">
                                    <label class="custom-control-label" for="info-highlight">
                                        Aktifkan sorot informasi di halaman utama
                                    </label>
                                </div>
                                <small class="form-text text-muted">Jika diaktifkan maka gambar sampul informasi akan
                                    dimunculkan
                                    pada halaman beranda</small>
                            </div>

                            <div class="form-group">
                                <label class="font-weight-bold">Status Publikasi <span
                                        class="text-danger">*</span></label>
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <div class="card border">
                                            <div class="card-body p-3">
                                                <div class="custom-control custom-radio">
                                                    <input type="radio" id="status-publish" name="status"
                                                        class="custom-control-input" value="PUBLISH" checked>
                                                    <label class="custom-control-label" for="status-publish">
                                                        <i class="fas fa-check-circle text-success mr-1"></i>
                                                        <strong>Diterbitkan</strong>
                                                        <small class="d-block text-muted">Informasi akan langsung
                                                            tampil</small>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6 mb-2">
                                        <div class="card border">
                                            <div class="card-body p-3">
                                                <div class="custom-control custom-radio">
                                                    <input type="radio" id="status-draft" name="status"
                                                        class="custom-control-input" value="DRAFT">
                                                    <label class="custom-control-label" for="status-draft">
                                                        <i class="fas fa-file-alt text-warning mr-1"></i>
                                                        <strong>Draf</strong>
                                                        <small class="d-block text-muted">Simpan sebagai draf terlebih
                                                            dahulu</small>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <!-- Tombol Aksi -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card border-0 shadow-sm rounded-lg">
                                        <div class="card-body bg-white text-center">
                                            <button type="submit" id="btn-submit"
                                                class="btn btn-outline-primary btn-block py-2 font-weight-semibold">
                                                <i class="fas fa-check-circle mr-2" id="btn-icon"></i>
                                                <span id="btn-text">Simpan Data</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- KOLOM KANAN -->
                <div class="col-lg-6 mb-4">
                    <div class="card">
                        <div class="card-body p-4">

                            <h5 class="font-weight-bold mb-4">
                                <i class="fas fa-bullhorn text-primary mr-2"></i>Pengumuman Informasi (Opsional)
                            </h5>

                            <p class="text-muted small">Pengiriman pengumuman informasi hanya berlaku untuk informasi
                                yang diterbitkan</p>

                            <div class="form-group">
                                <label class="font-weight-bold">Channel Notifikasi</label>
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <div class="card border">
                                            <div class="card-body p-3">
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="custom-control-input" id="channel-wa"
                                                        name="channels[]" value="whatsapp">
                                                    <label class="custom-control-label" for="channel-wa">
                                                        <i class="fab fa-whatsapp text-success mr-2"
                                                            style="font-size:1.2rem;"></i>
                                                        <strong>WhatsApp</strong>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6 mb-2">
                                        <div class="card border">
                                            <div class="card-body p-3">
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="custom-control-input"
                                                        id="channel-email" name="channels[]" value="email">
                                                    <label class="custom-control-label" for="channel-email">
                                                        <i class="fas fa-envelope text-danger mr-2"
                                                            style="font-size:1.2rem;"></i>
                                                        <strong>Email</strong>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <hr class="my-4">

                            <h6 class="font-weight-bold mb-3">
                                <i class="fas fa-users text-primary mr-2"></i>Penerima Pengumuman
                            </h6>

                            <div class="form-group">
                                <label class="font-weight-bold">Unit Pendidikan</label>
                                <select name="unit" id="unit" class="custom-select">
                                    <option value="">Pilih Unit</option>
                                    <option value="ALL">-- SEMUA --</option>
                                    <option value="SD">SD</option>
                                    <option value="SMP">SMP</option>
                                    <option value="SMA">SMA</option>
                                </select>
                            </div>

                            <div class="form-group" id="classroom-section" style="display:none;">
                                <label class="font-weight-bold">Pilih Kelas</label>

                                <div class="custom-control custom-switch mb-2">
                                    <input type="checkbox" class="custom-control-input" id="select-classroom">
                                    <label class="custom-control-label" for="select-classroom">Memilih kelas
                                        tertentu</label>
                                </div>

                                <small class="form-text text-muted">Memilih daftar kelas untuk mengirimkan pengumuman
                                    informasi</small>

                                <div id="classroom-table" class="border rounded p-3 mt-3" style="display:none;">
                                    <div class="table-responsive" style="max-height:300px;">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="thead-light">
                                                <tr>
                                                    <th width="30">
                                                        <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input"
                                                                id="classroom-checks">
                                                            <label class="custom-control-label"
                                                                for="classroom-checks"></label>
                                                        </div>
                                                    </th>
                                                    <th width="30">#</th>
                                                    <th>Unit</th>
                                                    <th>Kode Kelas</th>
                                                    <th>Nama Kelas</th>
                                                    <th>Tahun Ajaran</th>
                                                    <th>Jml. Siswa</th>
                                                </tr>
                                            </thead>
                                            <tbody id="classroom-list">
                                                <tr>
                                                    <td colspan="7" class="text-center text-muted">Pilih unit terlebih
                                                        dahulu</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>

                            <div class="form-group" id="student-section" style="display:none;">
                                <label class="font-weight-bold">Daftar Siswa</label>

                                <div class="custom-control custom-switch mb-2">
                                    <input type="checkbox" class="custom-control-input" id="select-student">
                                    <label class="custom-control-label" for="select-student">Pilih siswa
                                        tertentu</label>
                                </div>

                                <div id="student-table" class="border rounded p-3 mt-3" style="display:none;">
                                    <div class="table-responsive" style="max-height:300px;">
                                        <table class="table table-sm table-hover mb-0">
                                            <thead class="thead-light">
                                                <tr>
                                                    <th width="30">
                                                        <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input"
                                                                id="student-checks">
                                                            <label class="custom-control-label"
                                                                for="student-checks"></label>
                                                        </div>
                                                    </th>
                                                    <th width="30">#</th>
                                                    <th>Kelas</th>
                                                    <th>Nomor Induk</th>
                                                    <th>Nama Lengkap</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="student-list">
                                                <tr>
                                                    <td colspan="6" class="text-center text-muted">Pilih kelas terlebih
                                                        dahulu</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>
                </div>

            </div> <!-- END row -->



        </form>


        <!-- Footer -->
        <footer class="bg-white py-3 mt-5 border-top">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12 text-center">
                        <p class="mb-0 text-muted">Powered By Akeno PPDB System &copy; 2022-2025</p>
                    </div>
                </div>
            </div>
        </footer>

        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <!-- Popper.js -->
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

        <script>
            fetch("../../../Navbar/navbar.html")
                .then(res => res.text())
                .then(html => {
                    const navbar = document.getElementById("navbar");
                    navbar.innerHTML = html;

                    // Menjalankan ulang semua script yang ada di navbar.html
                    navbar.querySelectorAll("script").forEach(oldScript => {
                        const newScript = document.createElement("script");
                        if (oldScript.src) {
                            newScript.src = oldScript.src;
                        } else {
                            newScript.innerHTML = oldScript.innerHTML;
                        }
                        document.body.appendChild(newScript);
                    });

                    // PANGGIL FUNGSI ACTIVE STATE SETELAH NAVBAR LOADED
                    // Tunggu 200ms untuk memastikan semua script navbar selesai
                    setTimeout(function () {
                        setActiveNavbar();
                    }, 200);
                });

            $(document).ready(function () {

                // ===============================
                // ALERT SYSTEM
                // ===============================
                function showAlert(title, message, type = "info") {
                    $("#alert-title").text(title);
                    $("#alert-content").text(message);

                    let iconClass = {
                        info: "fas fa-info-circle text-primary",
                        success: "fas fa-check-circle text-success",
                        warning: "fas fa-exclamation-circle text-warning",
                        danger: "fas fa-times-circle text-danger"
                    };

                    $("#alert-icon").attr("class", iconClass[type] + " fa-2x");

                    $("#alert")
                        .removeClass("fade")
                        .addClass("show")
                        .css("display", "block");
                }

                window.hideAlert = function () {
                    $("#alert").removeClass("show").addClass("fade");
                    setTimeout(() => $("#alert").hide(), 200);
                };


                // ===============================
                // PREVIEW GAMBAR
                // ===============================
                $("#info-thumbnail").on("change", function () {
                    let file = this.files[0];

                    if (!file) return;

                    if (file.size > 2 * 1024 * 1024) {
                        $("#info-thumbnail-feedback").text("Ukuran gambar maksimal 2MB!").show();
                        return;
                    }

                    $("#info-thumbnail-feedback").hide();

                    let reader = new FileReader();
                    reader.onload = function (e) {
                        $("#preview-img").attr("src", e.target.result);
                        $("#image-preview").show();
                    };
                    reader.readAsDataURL(file);

                    $(this).next(".custom-file-label").text(file.name);
                });


                // ===============================
                // LOGIKA UNIT → KELAS → SISWA
                // ===============================
                $("#unit").on("change", function () {
                    let unit = $(this).val();

                    $("#student-section").hide();
                    $("#student-table").hide();

                    if (unit === "") {
                        $("#classroom-section").hide();
                        $("#classroom-list").html(`<tr><td colspan="7" class="text-center text-muted">Pilih unit terlebih dahulu</td></tr>`);
                        return;
                    }

                    $("#classroom-section").show();

                    if (unit === "ALL") {
                        $("#classroom-list").html(`<tr><td colspan="7" class="text-center text-muted">Semua unit dipilih (tidak perlu memilih kelas)</td></tr>`);
                        return;
                    }

                    let dataKelas = [
                        { unit: unit, kode: "KLS-01", nama: "Kelas A", tahun: "2024/2025", jumlah: 32 },
                        { unit: unit, kode: "KLS-02", nama: "Kelas B", tahun: "2024/2025", jumlah: 30 }
                    ];

                    let html = "";
                    dataKelas.forEach((v, i) => {
                        html += `
                <tr>
                    <td>
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input class-item" id="class-${i}">
                            <label class="custom-control-label" for="class-${i}"></label>
                        </div>
                    </td>
                    <td>${i + 1}</td>
                    <td>${v.unit}</td>
                    <td>${v.kode}</td>
                    <td>${v.nama}</td>
                    <td>${v.tahun}</td>
                    <td>${v.jumlah}</td>
                </tr>`;
                    });

                    $("#classroom-list").html(html);
                });


                // Checkbox kelas → select all
                $("#classroom-checks").on("change", function () {
                    $(".class-item").prop("checked", this.checked);
                });


                // Toggle tampilan tabel kelas
                $("#select-classroom").on("change", function () {
                    $("#classroom-table").toggle(this.checked);
                });



                // ===============================
                // FORM SUBMIT
                // ===============================
                $("#form-information").on("submit", function (e) {
                    e.preventDefault();

                    let title = $("#info-title").val().trim();
                    let content = $("#info-content").val().trim();

                    if (title === "") {
                        $("#info-title-feedback").text("Judul tidak boleh kosong").show();
                        return showAlert("Gagal", "Harap masukan judul informasi!", "danger");
                    } else {
                        $("#info-title-feedback").hide();
                    }

                    if (content === "") {
                        $("#info-content-feedback").text("Isi konten tidak boleh kosong").show();
                        return showAlert("Gagal", "Harap masukan isi konten informasi!", "danger");
                    } else {
                        $("#info-content-feedback").hide();
                    }

                    $("#btn-text").text("Menyimpan...");
                    $("#btn-icon").attr("class", "fas fa-spinner fa-spin");

                    setTimeout(() => {
                        $("#btn-text").text("Simpan Data");
                        $("#btn-icon").attr("class", "fas fa-check-circle");

                        showAlert("Berhasil", "Informasi berhasil disimpan!", "success");
                    }, 1200);
                });


            });
        </script>

</body>

</html>