<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Perbarui Profil Akun :: Sistem Penerimaan Peserta Didik Baru</title>
    <meta name="description" content="Sistem Penerimaan Peserta Didik Baru">
    <meta name="author" content="Akeno PPDB System">
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Croppie CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.css">
</head>

<body style="font-family: 'Inter', sans-serif; background-color: #f5f5f5;">

    <!-- NAVBAR -->
    <div id="navbar"></div>

    <!-- MAIN CONTENT -->
    <div class="container-fluid py-4">

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb bg-white px-3 mb-2">
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none">PPDB</a></li>
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none">Pengaturan Akun</a></li>
                <li class="breadcrumb-item active">Perbarui Profil</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="ml-2">
                <h2 class="font-weight-bold mb-1">Pengaturan Akun</h2>
                <p class="text-muted mb-0"><i class="fas fa-user-cog mr-1"></i>Kelola profil dan informasi akun Anda</p>
            </div>
        </div>

        <!-- Alert -->
        <div id="alert" class="alert alert-dismissible fade" role="alert"
            style="display: none; border-left: 4px solid #667eea;">
            <div class="d-flex align-items-center">
                <div class="mr-3">
                    <i id="alert-warning-icon" class="fas fa-exclamation-triangle fa-2x text-warning"
                        style="display: none;"></i>
                    <i id="alert-success-icon" class="fas fa-check-circle fa-2x text-success"
                        style="display: none;"></i>
                </div>
                <div class="flex-grow-1">
                    <h6 id="alert-title" class="alert-heading font-weight-bold mb-1">Informasi</h6>
                    <div id="alert-content" class="mb-0"></div>
                </div>
            </div>
            <button type="button" class="close" onclick="hideAlert()">
                <span>&times;</span>
            </button>
        </div>

        <!-- Page Body -->
        <div class="page-body">
            <div class="row">
                <!-- Sidebar Menu -->
                <div class="col-12 col-md-4 d-none d-md-block border-right">
                    <div class="list-group">
                        <!-- Item Profil Aktif -->
                        <a href="PerbaruiProfil.html"
                            class="list-group-item list-group-item-action bg-white position-relative font-weight-bold d-flex align-items-center">
                            <i class="fas fa-user mr-2 text-primary"></i>
                            Perbarui Profil
                            <span class="position-absolute w-100"
                                style="height:1px; bottom:0; left:0; background-color:#007bff;"></span>
                        </a>

                        <!-- Item Kata Sandi -->
                        <a href="PerbaruiKataSandi.html"
                            class="list-group-item list-group-item-action bg-white d-flex align-items-center">
                            <i class="fas fa-key mr-2 text-primary"></i>
                            Perbarui Kata Sandi
                        </a>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-12 col-md-8">
                    <div class="card shadow">
                        <div class="card-body" style="min-height: 562px;">

                            <!-- Header -->
                            <div
                                class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3 pb-2 border-bottom">
                                <div>
                                    <h5 class="mb-1 font-weight-bold">Perbarui Profil Akun</h5>
                                    <small class="text-muted">PPDB Akeno PPDB System Tahun 2025/2026</small>
                                </div>
                            </div>

                            <!-- Body Form -->
                            <div class="card-body">
                                <form id="form" action="javascript:void(0)" enctype="multipart/form-data">
                                    <div class="row">
                                        <!-- Peran Petugas -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group mb-4">
                                                <label class="form-label">Peran Petugas</label>
                                                <input type="text" class="form-control" disabled value="Petugas Admin">
                                            </div>
                                        </div>

                                        <!-- Nomor Induk Petugas -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group mb-4">
                                                <label class="form-label">Nomor Induk Petugas</label>
                                                <input type="text" class="form-control" disabled value="20250601001">
                                            </div>
                                        </div>

                                        <!-- Nama Lengkap -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group mb-4">
                                                <label class="form-label">Nama Lengkap <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" name="account_fullname" id="account-fullname"
                                                    class="form-control" maxlength="64" autocomplete="off"
                                                    value="Admin Operator">
                                                <small id="account-fullname-feedback" class="form-text text-danger"
                                                    style="display: none;"></small>
                                            </div>
                                        </div>

                                        <!-- Alamat Email -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group mb-4">
                                                <label class="form-label">Alamat Email <span
                                                        class="text-danger">*</span></label>
                                                <input type="email" name="account_email" id="account-email"
                                                    class="form-control" maxlength="64" autocomplete="off"
                                                    value="admin@email.com">
                                                <small id="account-email-feedback" class="form-text text-danger"
                                                    style="display: none;"></small>
                                            </div>
                                        </div>

                                        <!-- Nomor Telepon -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group mb-4">
                                                <label class="form-label">Nomor Telepon</label>
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">+62</span>
                                                    </div>
                                                    <input type="text" name="account_phone" id="account-phone"
                                                        class="form-control" maxlength="16" autocomplete="off" value="">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Foto Profil -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group mb-4">
                                                <label class="font-weight-bold">
                                                    <i class="fas fa-user-circle text-primary mr-1"></i>
                                                    Foto Profil
                                                </label>
                                                <input type="hidden" name="account_photo" id="account-photo">
                                                <div class="mb-2">
                                                    <img src="#"
                                                        id="preview-image" class="img-thumbnail"
                                                        style="width: 120px; height: 120px; object-fit: cover; cursor: pointer;"
                                                        draggable="false">
                                                </div>
                                                <div class="custom-file mb-2">
                                                    <input type="file" class="custom-file-input" id="load-photo"
                                                        accept=".png, .jpg, .jpeg">
                                                    <label class="custom-file-label text-left" for="load-photo">
                                                        Pilih file...
                                                    </label>
                                                </div>
                                                <button type="button" id="btn-remove-image"
                                                    class="btn btn-secondary btn-sm btn-block" data-remove="true"
                                                    style="display: none;">
                                                    <i class="fas fa-trash mr-1"></i>Hapus Foto
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Button Submit -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <button type="submit" id="btn-submit" class="btn btn-primary btn-block">
                                                    <i class="fas fa-save mr-1" id="btn-icon"></i>
                                                    <span id="btn-text">Simpan Perubahan</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer footer-transparent d-print-none mt-4">
            <div class="container-fluid">
                <div class="row text-center align-items-center">
                    <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                        <ul class="list-inline list-inline-dots mb-0">
                            <li class="list-inline-item">
                                Copyright &copy; 2025 Akeno PPDB System
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal Croppie -->
    <div id="croppie-modal" class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Crop Foto Profil</h5>
                </div>
                <div class="modal-body text-center pb-0">
                    <div id="load-image-preview"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btn-image-abort" class="btn btn-secondary" data-dismiss="modal">
                        Batalkan
                    </button>
                    <button type="button" id="btn-image-crop" class="btn btn-primary">
                        Pilih
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Zoom Image -->
    <div id="zoom-dialog" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center pt-4 pb-2 px-3">
                    <img id="image-zoom-preview" draggable="false" class="img-fluid">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery, Popper.js, Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

    <!-- Croppie JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        fetch("../../Navbar/navbar.html")
            .then(res => res.text())
            .then(html => {
                const navbar = document.getElementById("navbar");
                navbar.innerHTML = html;

                // Menjalankan ulang semua script yang ada di navbar.html
                navbar.querySelectorAll("script").forEach(oldScript => {
                    const newScript = document.createElement("script");
                    if (oldScript.src) {
                        newScript.src = oldScript.src;
                    } else {
                        newScript.innerHTML = oldScript.innerHTML;
                    }
                    document.body.appendChild(newScript);
                });

                // PANGGIL FUNGSI ACTIVE STATE SETELAH NAVBAR LOADED
                // Tunggu 200ms untuk memastikan semua script navbar selesai
                setTimeout(function () {
                    setActiveNavbar();
                }, 200);
            });

        const defaultSrc = 'https://demo.schoolpay.co.id/media/images/account/photo.png';
        let croppie;

        // Hide Alert Function
        function hideAlert() {
            $('#alert').removeClass('show').fadeOut();
        }

        // Show Alert Function
        function showAlert(title, message, type) {
            const alert = $('#alert');
            const alertTitle = $('#alert-title');
            const alertContent = $('#alert-content');
            const warningIcon = $('#alert-warning-icon');
            const successIcon = $('#alert-success-icon');

            alertTitle.text(title);
            alertContent.html(message);

            // Hide all icons first
            warningIcon.hide();
            successIcon.hide();

            // Remove all alert classes
            alert.removeClass('alert-warning alert-success alert-info alert-danger');

            if (type === 'success') {
                alert.addClass('alert-success');
                successIcon.show();
            } else if (type === 'warning') {
                alert.addClass('alert-warning');
                warningIcon.show();
            } else if (type === 'danger') {
                alert.addClass('alert-danger');
                warningIcon.show();
            }

            alert.fadeIn().addClass('show');

            setTimeout(function () {
                hideAlert();
            }, 5000);
        }

        // Get Image Function
        $.getImage = function (i, c) {
            if (i.files && i.files[0]) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    c.bind({
                        url: e.target.result,
                    }).then(function () {
                        console.log('jQuery bind complete');
                    });
                }

                reader.readAsDataURL(i.files[0]);
            }
        }

        $(document).ready(function () {
            // Custom file input label update
            $('#load-photo').on('change', function () {
                var fileName = $(this).val().split('\\').pop();
                $(this).next('.custom-file-label').html(fileName || 'Pilih file...');
            });

            // Prevent spaces in email and phone
            $('#account-phone, #account-email').on({
                keydown: function (e) {
                    if (e.which == 32) {
                        return false;
                    }
                },
                change: function () {
                    this.value = this.value.replace(/\s/g, '');
                }
            });

            // Load Photo Change Event
            $('#load-photo').on('change', function (e) {
                if (!e.target.files || !e.target.files[0]) {
                    return;
                }

                $('#croppie-modal').modal('show');

                let preview = document.getElementById('load-image-preview');

                let boundaryWidth = $('.modal-body').width(),
                    boundaryHeight = boundaryWidth,
                    viewportWidth = boundaryWidth - (boundaryWidth / 100 * 25),
                    viewportHeight = boundaryHeight - (boundaryHeight / 100 * 25);

                croppie = new Croppie(preview, {
                    viewport: {
                        width: viewportWidth,
                        height: viewportHeight
                    },
                    boundary: {
                        height: boundaryHeight
                    },
                    enableOrientation: true,
                });

                $.getImage(e.target, croppie);
            });

            // Button Crop Image
            $('#btn-image-crop').click(function (e) {
                croppie.result({
                    type: 'base64',
                    size: 'viewport',
                }).then(function (f) {
                    $('#account-photo').val(f);
                    $('#preview-image').attr('src', f);
                    $('#croppie-modal').modal('hide');
                    $('#load-image-preview').empty();
                    $('#load-photo').next('.custom-file-label').html('Foto berhasil dipilih');
                    $('#btn-remove-image').show();
                });

                $('#load-photo').val('');
                croppie.destroy();
            });

            // Button Abort Crop
            $('#btn-image-abort').click(function () {
                $('#load-photo').val('');
                $('#load-photo').next('.custom-file-label').html('Pilih file...');
                $('#load-image-preview').empty();
                if (croppie) {
                    croppie.destroy();
                }
            });

            // Button Remove Image
            $('#btn-remove-image').click(function () {
                if ($('#btn-remove-image').data('remove')) {
                    $('#btn-remove-image').hide();
                    $('#account-photo').val('reset');
                    $('#preview-image').attr('src', defaultSrc);
                    $('#load-photo').val('');
                    $('#load-photo').next('.custom-file-label').html('Pilih file...');
                    $('#btn-remove-image').data('remove', false);
                } else {
                    $('#btn-remove-image').hide();
                    $('#account-photo').val('');
                    $('#preview-image').attr('src', defaultSrc);
                    $('#load-photo').val('');
                    $('#load-photo').next('.custom-file-label').html('Pilih file...');
                }
            });

            // Image Zoom Click
            $('body').on('click', '.img-thumbnail', function () {
                if ($(this).attr('src')) {
                    $('#image-zoom-preview').attr('src', $(this).attr('src'));
                    $('#zoom-dialog').modal('show');
                }

                if ($(this).data('src')) {
                    $('#image-zoom-preview').attr('src', $(this).data('src'));
                    $('#zoom-dialog').modal('show');
                }
            });

            // Form Validation
            function validateForm() {
                let isValid = true;

                // Validate Fullname
                const fullname = $('#account-fullname').val().trim();
                if (fullname === '') {
                    $('#account-fullname').addClass('is-invalid');
                    $('#account-fullname-feedback').text('Nama lengkap wajib diisi').show();
                    isValid = false;
                } else {
                    $('#account-fullname').removeClass('is-invalid');
                    $('#account-fullname-feedback').hide();
                }

                // Validate Email
                const email = $('#account-email').val().trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (email === '') {
                    $('#account-email').addClass('is-invalid');
                    $('#account-email-feedback').text('Alamat email wajib diisi').show();
                    isValid = false;
                } else if (!emailRegex.test(email)) {
                    $('#account-email').addClass('is-invalid');
                    $('#account-email-feedback').text('Format email tidak valid').show();
                    isValid = false;
                } else {
                    $('#account-email').removeClass('is-invalid');
                    $('#account-email-feedback').hide();
                }

                return isValid;
            }

            // Form Submit
            $('#form').on('submit', function (e) {
                e.preventDefault();

                if (!validateForm()) {
                    showAlert('Validasi Gagal', 'Mohon lengkapi semua field yang wajib diisi dengan benar.', 'warning');
                    return;
                }

                // Change button state
                $('#btn-submit').prop('disabled', true);
                $('#btn-icon').removeClass('fa-save').addClass('fa-spinner fa-spin');
                $('#btn-text').text('Menyimpan...');

                // Get form data
                const formData = {
                    account_fullname: $('#account-fullname').val(),
                    account_email: $('#account-email').val(),
                    account_phone: $('#account-phone').val(),
                    account_photo: $('#account-photo').val()
                };

                // Simulate AJAX request (replace with actual endpoint)
                setTimeout(function () {
                    // Success response
                    showAlert('Berhasil', 'Data profil berhasil diperbarui.', 'success');

                    // Reset button state
                    $('#btn-submit').prop('disabled', false);
                    $('#btn-icon').removeClass('fa-spinner fa-spin').addClass('fa-save');
                    $('#btn-text').text('Simpan Perubahan');

                    // If photo was changed, update label
                    if ($('#account-photo').val()) {
                        $('#load-photo').next('.custom-file-label').html('Foto berhasil diperbarui');
                        $('#btn-remove-image').data('remove', true);
                    }

                    console.log('Form Data:', formData);
                }, 1500);

                // For actual implementation, use:
                /*
                $.ajax({
                    url: 'your-endpoint-url',
                    type: 'POST',
                    data: formData,
                    success: function(response) {
                        showAlert('Berhasil', 'Data profil berhasil diperbarui.', 'success');
                        $('#btn-submit').prop('disabled', false);
                        $('#btn-icon').removeClass('fa-spinner fa-spin').addClass('fa-save');
                        $('#btn-text').text('Simpan Perubahan');
                    },
                    error: function(xhr, status, error) {
                        showAlert('Gagal', 'Terjadi kesalahan saat menyimpan data.', 'danger');
                        $('#btn-submit').prop('disabled', false);
                        $('#btn-icon').removeClass('fa-spinner fa-spin').addClass('fa-save');
                        $('#btn-text').text('Simpan Perubahan');
                    }
                });
                */
            });

            // Remove validation error on input
            $('#account-fullname, #account-email').on('input', function () {
                $(this).removeClass('is-invalid');
                $(this).siblings('.form-text').hide();
            });
        });
    </script>
</body>

</html>