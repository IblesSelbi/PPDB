<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Perbarui Kata Sandi Akun :: Sistem Penerimaan Peserta Didik Baru</title>
    <meta name="description" content="Sistem Penerimaan Peserta Didik Baru">
    <meta name="author" content="Akeno PPDB System">
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body style="font-family: 'Inter', sans-serif; background-color: #f5f5f5;">

    <!-- NAVBAR -->
    <div id="navbar"></div>

    <!-- MAIN CONTENT -->
    <div class="container-fluid py-4">

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb bg-white px-3 mb-2">
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none">PPDB</a></li>
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none">Pengaturan Akun</a></li>
                <li class="breadcrumb-item active">Perbarui Kata Sandi</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="ml-2">
                <h2 class="font-weight-bold mb-1">Pengaturan Akun</h2>
                <p class="text-muted mb-0"><i class="fas fa-user-cog mr-1"></i>Kelola profil dan informasi akun Anda</p>
            </div>
        </div>

        <!-- Alert -->
        <div id="alert" class="alert alert-dismissible fade" role="alert"
            style="display: none; border-left: 4px solid #667eea;">
            <div class="d-flex align-items-center">
                <div class="mr-3">
                    <i id="alert-warning-icon" class="fas fa-exclamation-triangle fa-2x text-warning"
                        style="display: none;"></i>
                    <i id="alert-success-icon" class="fas fa-check-circle fa-2x text-success"
                        style="display: none;"></i>
                </div>
                <div class="flex-grow-1">
                    <h6 id="alert-title" class="alert-heading font-weight-bold mb-1">Informasi</h6>
                    <div id="alert-content" class="mb-0"></div>
                </div>
            </div>
            <button type="button" class="close" onclick="hideAlert()">
                <span>&times;</span>
            </button>
        </div>

        <!-- Page Body -->
        <div class="page-body">
            <div class="row">
                <!-- Sidebar Menu -->
                <div class="col-12 col-md-4 d-none d-md-block border-right">
                    <div class="list-group">
                        <!-- Item Profil -->
                        <a href="PerbaruiProfil.html"
                            class="list-group-item list-group-item-action bg-white d-flex align-items-center">
                            <i class="fas fa-user mr-2 text-primary"></i>
                            Perbarui Profil
                        </a>

                        <!-- Item Kata Sandi Aktif -->
                        <a href="PerbaruiKataSandi.html"
                            class="list-group-item list-group-item-action bg-white position-relative font-weight-bold d-flex align-items-center">
                            <i class="fas fa-key mr-2 text-primary"></i>
                            Perbarui Kata Sandi
                            <span class="position-absolute w-100"
                                style="height:1px; bottom:0; left:0; background-color:#007bff;"></span>
                        </a>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-12 col-md-8">
                    <div class="card shadow">
                        <div class="card-body" style="min-height: 562px;">

                            <!-- Header -->
                            <div
                                class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3 pb-2 border-bottom">
                                <div>
                                    <h5 class="mb-1 font-weight-bold">Perbarui Kata Sandi Akun</h5>
                                    <small class="text-muted">PPDB Akeno PPDB System Tahun 2025/2026</small>
                                </div>
                            </div>

                            <!-- Body Form -->
                            <div class="card-body">
                                <form id="form" action="javascript:void(0)">

                                    <!-- Info Alert -->
                                    <div class="alert alert-info mb-4">
                                        <span class="text-muted">
                                            Kata sandi akun anda terakhir diperbarui pada <strong>02 April 2024,
                                                16:38</strong>
                                        </span>
                                    </div>

                                    <div class="row">
                                        <!-- Kata Sandi Saat Ini -->
                                        <div class="col-sm-12 col-md-12">
                                            <div class="form-group mb-4">
                                                <label class="form-label">Kata Sandi Saat Ini <span
                                                        class="text-danger">*</span></label>
                                                <input type="password" name="password" id="password"
                                                    class="form-control" maxlength="16" autocomplete="off">
                                                <small id="password-feedback" class="form-text text-danger"
                                                    style="display: none;"></small>
                                            </div>
                                        </div>

                                        <!-- Kata Sandi Baru -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group mb-4">
                                                <label class="form-label">Kata Sandi Baru <span
                                                        class="text-danger">*</span></label>
                                                <input type="password" name="new_password" id="new-password"
                                                    class="form-control" maxlength="16" autocomplete="off">
                                                <small id="new-password-feedback" class="form-text text-danger"
                                                    style="display: none;"></small>
                                            </div>
                                        </div>

                                        <!-- Konfirmasi Kata Sandi Baru -->
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group mb-4">
                                                <label class="form-label">Konfirmasi Kata Sandi Baru <span
                                                        class="text-danger">*</span></label>
                                                <input type="password" name="password_confirmation"
                                                    id="confirm-password" class="form-control" maxlength="16"
                                                    autocomplete="off">
                                                <small id="confirm-password-feedback" class="form-text text-danger"
                                                    style="display: none;"></small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Toggle Password Visibility -->
                                    <div class="mb-4">
                                        <button type="button" id="password-icon" class="btn btn-secondary">
                                            <i class="fas fa-eye fa"></i>
                                        </button>
                                        <button type="button" id="password-icon-off" class="btn btn-secondary"
                                            style="display: none;">
                                            <i class="fas fa-eye-slash fa"></i>
                                        </button>
                                    </div>

                                    <!-- Button Submit -->
                                    <div class="row">
                                        <div class="col-sm-12 col-md-6">
                                            <div class="form-group">
                                                <button type="submit" id="btn-submit" class="btn btn-primary btn-block">
                                                    <i class="fas fa-save mr-1" id="btn-icon"></i>
                                                    <span id="btn-text">Simpan Perubahan</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer footer-transparent d-print-none mt-4">
            <div class="container-fluid">
                <div class="row text-center align-items-center">
                    <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                        <ul class="list-inline list-inline-dots mb-0">
                            <li class="list-inline-item">
                                Copyright &copy; 2025 Akeno PPDB System
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- jQuery, Popper.js, Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        fetch("../../Navbar/navbar.html")
            .then(res => res.text())
            .then(html => {
                const navbar = document.getElementById("navbar");
                navbar.innerHTML = html;

                // Menjalankan ulang semua script yang ada di navbar.html
                navbar.querySelectorAll("script").forEach(oldScript => {
                    const newScript = document.createElement("script");
                    if (oldScript.src) {
                        newScript.src = oldScript.src;
                    } else {
                        newScript.innerHTML = oldScript.innerHTML;
                    }
                    document.body.appendChild(newScript);
                });

                // PANGGIL FUNGSI ACTIVE STATE SETELAH NAVBAR LOADED
                // Tunggu 200ms untuk memastikan semua script navbar selesai
                setTimeout(function () {
                    setActiveNavbar();
                }, 200);
            });

        // Hide Alert Function
        function hideAlert() {
            $('#alert').removeClass('show').fadeOut();
        }

        // Show Alert Function
        function showAlert(title, message, type) {
            const alert = $('#alert');
            const alertTitle = $('#alert-title');
            const alertContent = $('#alert-content');
            const warningIcon = $('#alert-warning-icon');
            const successIcon = $('#alert-success-icon');

            alertTitle.text(title);
            alertContent.html(message);

            // Hide all icons first
            warningIcon.hide();
            successIcon.hide();

            // Remove all alert classes
            alert.removeClass('alert-warning alert-success alert-info alert-danger');

            if (type === 'success') {
                alert.addClass('alert-success');
                successIcon.show();
            } else if (type === 'warning') {
                alert.addClass('alert-warning');
                warningIcon.show();
            } else if (type === 'danger') {
                alert.addClass('alert-danger');
                warningIcon.show();
            }

            alert.fadeIn().addClass('show');

            setTimeout(function () {
                hideAlert();
            }, 5000);
        }

        $(document).ready(function () {
            // Prevent spaces in password fields
            $('#password, #new-password, #confirm-password').on({
                keydown: function (e) {
                    if (e.which == 32) {
                        return false;
                    }
                },
                change: function () {
                    this.value = this.value.replace(/\s/g, '');
                }
            });

            // Toggle password visibility
            $('#password-icon').on('click', function () {
                $('#password, #new-password, #confirm-password').attr('type', 'text');
                $('#password-icon').hide();
                $('#password-icon-off').show();
            });

            $('#password-icon-off').on('click', function () {
                $('#password, #new-password, #confirm-password').attr('type', 'password');
                $('#password-icon-off').hide();
                $('#password-icon').show();
            });

            // Real-time password confirmation check
            $('#confirm-password').on('keyup', function () {
                const newPassword = $('#new-password').val();
                const confirmPassword = $('#confirm-password').val();

                if (confirmPassword !== '' && newPassword !== confirmPassword) {
                    $('#confirm-password').addClass('is-invalid');
                    $('#confirm-password-feedback').text('Konfirmasi kata sandi baru tidak sesuai').show();
                    $('#btn-submit').prop('disabled', true);
                } else {
                    $('#confirm-password').removeClass('is-invalid');
                    $('#confirm-password-feedback').hide();
                    $('#btn-submit').prop('disabled', false);
                }
            });

            // Form Validation
            function validateForm() {
                let isValid = true;

                // Validate Current Password
                const password = $('#password').val().trim();
                if (password === '') {
                    $('#password').addClass('is-invalid');
                    $('#password-feedback').text('Kata sandi saat ini wajib diisi').show();
                    isValid = false;
                } else {
                    $('#password').removeClass('is-invalid');
                    $('#password-feedback').hide();
                }

                // Validate New Password
                const newPassword = $('#new-password').val().trim();
                if (newPassword === '') {
                    $('#new-password').addClass('is-invalid');
                    $('#new-password-feedback').text('Kata sandi baru wajib diisi').show();
                    isValid = false;
                } else if (newPassword.length < 6) {
                    $('#new-password').addClass('is-invalid');
                    $('#new-password-feedback').text('Kata sandi baru minimal 6 karakter').show();
                    isValid = false;
                } else {
                    $('#new-password').removeClass('is-invalid');
                    $('#new-password-feedback').hide();
                }

                // Validate Confirm Password
                const confirmPassword = $('#confirm-password').val().trim();
                if (confirmPassword === '') {
                    $('#confirm-password').addClass('is-invalid');
                    $('#confirm-password-feedback').text('Konfirmasi kata sandi baru wajib diisi').show();
                    isValid = false;
                } else if (newPassword !== confirmPassword) {
                    $('#confirm-password').addClass('is-invalid');
                    $('#confirm-password-feedback').text('Konfirmasi kata sandi baru tidak sesuai').show();
                    isValid = false;
                } else {
                    $('#confirm-password').removeClass('is-invalid');
                    $('#confirm-password-feedback').hide();
                }

                return isValid;
            }

            // Form Submit
            $('#form').on('submit', function (e) {
                e.preventDefault();

                if (!validateForm()) {
                    showAlert('Validasi Gagal', 'Mohon lengkapi semua field yang wajib diisi dengan benar.', 'warning');
                    return;
                }

                // Change button state
                $('#btn-submit').prop('disabled', true);
                $('#btn-icon').removeClass('fa-save').addClass('fa-spinner fa-spin');
                $('#btn-text').text('Menyimpan...');

                // Get form data
                const formData = {
                    password: $('#password').val(),
                    new_password: $('#new-password').val(),
                    password_confirmation: $('#confirm-password').val()
                };

                // Simulate AJAX request (replace with actual endpoint)
                setTimeout(function () {
                    // Success response
                    showAlert('Berhasil', 'Kata sandi akun berhasil diperbarui.', 'success');

                    // Reset button state
                    $('#btn-submit').prop('disabled', false);
                    $('#btn-icon').removeClass('fa-spinner fa-spin').addClass('fa-save');
                    $('#btn-text').text('Simpan Perubahan');

                    // Reset form
                    $('#form')[0].reset();

                    console.log('Form Data:', formData);
                }, 1500);

                // For actual implementation, use:
                /*
                $.ajax({
                    url: 'your-endpoint-url',
                    type: 'POST',
                    data: formData,
                    success: function(response) {
                        showAlert('Berhasil', 'Kata sandi akun berhasil diperbarui.', 'success');
                        $('#btn-submit').prop('disabled', false);
                        $('#btn-icon').removeClass('fa-spinner fa-spin').addClass('fa-save');
                        $('#btn-text').text('Simpan Perubahan');
                        $('#form')[0].reset();
                    },
                    error: function(xhr, status, error) {
                        showAlert('Gagal', 'Terjadi kesalahan saat menyimpan data.', 'danger');
                        $('#btn-submit').prop('disabled', false);
                        $('#btn-icon').removeClass('fa-spinner fa-spin').addClass('fa-save');
                        $('#btn-text').text('Simpan Perubahan');
                    }
                });
                */
            });

            // Remove validation error on input
            $('#password, #new-password, #confirm-password').on('input', function () {
                $(this).removeClass('is-invalid');
                $(this).siblings('.form-text').hide();
            });
        });
    </script>
</body>

</html>