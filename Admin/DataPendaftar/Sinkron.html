<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Sinkron Data Pendaftar :: PPDB</title>

  <!-- Bootstrap 4 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
</head>

<body class="bg-light">
  <!-- NAVBAR -->
  <div id="navbar"></div>

  <div class="container-fluid py-4">
    <!-- HEADER -->
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-3">
      <ol class="breadcrumb bg-white px-3 mb-2">
        <li class="breadcrumb-item">
          <a href="DataPendaftar.html" class="text-decoration-none">PPDB</a>
        </li>
        <li class="breadcrumb-item">
          <a href="DataPendaftar.html" class="text-decoration-none">Data Pendaftar</a>
        </li>
        <li class="breadcrumb-item active">Sinkron</li>
      </ol>
    </nav>

    <div class="bg-white shadow-sm rounded p-4 mb-4 border-left border-info">
      <div class="d-flex justify-content-between align-items-center flex-wrap">
        <div class="mb-3 mb-md-0">
          <h2 class="font-weight-bold text-info mb-2">
            Sinkronisasi Data Pendaftar
          </h2>
          <p class="text-muted mb-0">
            <i class="fas fa-info-circle mr-1 text-info"></i>Gunakan halaman
            ini untuk menyinkronkan data pendaftar dari sistem PPDB ke sistem
            lokal sekolah.
          </p>
        </div>
        <a href="DataPendaftar.html" class="btn btn-outline-primary font-weight-bold">
          <i class="fas fa-arrow-left mr-2"></i>Kembali
        </a>
      </div>
    </div>

    <!-- FILTER -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white d-flex justify-content-between align-items-center py-3" data-toggle="collapse"
        data-target="#filterCollapse" style="cursor: pointer">
        <h5 class="mb-0 font-weight-bold text-primary d-flex align-items-center">
          <i class="fas fa-filter mr-2 text-success"></i>Filter Data
        </h5>
        <i class="fas fa-chevron-down text-dark" id="filterIcon"></i>
      </div>
      <div id="filterCollapse" class="collapse show">
        <div class="card-body bg-light">
          <div class="row">
            <div class="col-md-3 mb-3">
              <label class="small font-weight-bold">Unit Pendidikan</label>
              <select class="custom-select" id="filterUnit">
                <option value="">Semua</option>
                <option value="SD">SD</option>
                <option value="SMP">SMP</option>
                <option value="SMA">SMA</option>
              </select>
            </div>
            <div class="col-md-3 mb-3">
              <label class="small font-weight-bold">Jenis Pendaftaran</label>
              <select class="custom-select" id="filterJenis">
                <option value="">Semua</option>
                <option value="Daftar Baru">Daftar Baru</option>
                <option value="Pindahan">Pindahan</option>
              </select>
            </div>
            <div class="col-md-3 mb-3">
              <label class="small font-weight-bold">Periode Pendaftaran</label>
              <select class="custom-select">
                <option>Semua</option>
                <option>Reguler</option>
              </select>
            </div>
            <div class="col-md-3 mb-3">
              <label class="small font-weight-bold">Status Pendaftaran</label>
              <select class="custom-select" id="filterStatus">
                <option value="">Semua</option>
                <option value="Menunggu Pembayaran">
                  Menunggu Pembayaran
                </option>
                <option value="Menunggu Persyaratan">
                  Menunggu Persyaratan
                </option>
              </select>
            </div>
            <div class="col-md-3 mb-3">
              <label class="small font-weight-bold">Status Verifikasi</label>
              <select class="custom-select" id="filterVerifikasi">
                <option value="">Semua</option>
                <option value="belum">Belum Diverifikasi</option>
                <option value="sudah">Sudah Diverifikasi</option>
              </select>
            </div>
            <div class="col-md-3 mb-3">
              <label class="small font-weight-bold">Status Sinkron</label>
              <select class="custom-select" id="filterSinkron">
                <option value="">Semua</option>
                <option value="belum">Belum Disinkron</option>
                <option value="sudah">Sudah Disinkron</option>
              </select>
            </div>
          </div>
          <button class="btn btn-success px-4 mr-2" id="btnTerapkanFilter">
            <i class="fas fa-search mr-2"></i>Terapkan Filter
          </button>
          <button class="btn btn-outline-secondary px-4" id="btnResetFilter">
            <i class="fas fa-redo mr-2"></i>Reset
          </button>
        </div>
      </div>
    </div>

    <!-- TABEL -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h5 class="font-weight-bold mb-0">
          <i class="fas fa-sync-alt text-success mr-2"></i>Data Pendaftar
          untuk Sinkronisasi
        </h5>
        <span class="badge badge-info badge-pill" id="totalData">Total: 3 data</span>
      </div>
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="thead-light">
            <tr>
              <th class="text-center align-middle" style="width: 50px">
                <div class="d-flex justify-content-center align-items-center">
                  <input type="checkbox" id="checkAll" class="form-check-input m-0" />
                </div>
              </th>
              <th style="width: 50px">#</th>
              <th>Unit</th>
              <th>No. Pendaftaran</th>
              <th>Nama Lengkap</th>
              <th>Jenis Kelamin</th>
              <th>Status Pendaftaran</th>
              <th>Kelas Sementara</th>
              <th>Status Verifikasi</th>
              <th>Status Sinkron</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Data Dummy 1 -->
            <tr data-id="1" data-unit="SMP" data-jenis="Daftar Baru" data-status="Menunggu Pembayaran"
              data-verifikasi="belum" data-sinkron="belum">
              <td class="text-center align-middle" style="width: 50px">
                <div class="d-flex justify-content-center align-items-center">
                  <input type="checkbox" class="form-check-input row-check m-0" data-id="1" />
                </div>
              </td>
              <td class="align-middle">1</td>
              <td class="align-middle">
                <span class="badge badge-info badge-pill px-3 py-2">SMP</span>
              </td>
              <td class="align-middle text-primary">
                <strong>2526-0010</strong>
              </td>
              <td class="align-middle">
                <div class="d-flex align-items-center">
                  <div
                    class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mr-2 font-weight-bold"
                    style="width: 35px; height: 35px">
                    SP
                  </div>
                  <div>
                    <strong>Septian</strong>
                    <small class="d-block text-muted">081234567890</small>
                  </div>
                </div>
              </td>
              <td class="align-middle">Laki-Laki</td>
              <td class="align-middle">
                <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                  <i class="fas fa-clock text-danger mr-2"></i>Menunggu
                  Pembayaran
                </span>
              </td>
              <td class="align-middle">-</td>
              <td class="align-middle">
                <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                  <i class="fas fa-times-circle text-danger mr-2"></i>Belum
                  Diverifikasi
                </span>
              </td>
              <td class="align-middle">
                <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                  <i class="fas fa-exclamation-circle text-warning mr-2"></i>Belum Disinkron
                </span>
              </td>
              <td class="text-center align-middle">
                <button class="btn btn-sm btn-outline-primary"
                  onclick="window.location.href='DetailPendaftaran.html?id=1'">
                  <i class="fas fa-info-circle mr-1"></i> Detail
                </button>
              </td>
            </tr>

            <!-- Data Dummy 2 -->
            <tr data-id="2" data-unit="SMP" data-jenis="Daftar Baru" data-status="Menunggu Persyaratan"
              data-verifikasi="belum" data-sinkron="belum">
              <td class="text-center align-middle" style="width: 50px">
                <div class="d-flex justify-content-center align-items-center">
                  <input type="checkbox" class="form-check-input row-check m-0" data-id="2" />
                </div>
              </td>
              <td class="align-middle">2</td>
              <td class="align-middle">
                <span class="badge badge-info badge-pill px-3 py-2">SMP</span>
              </td>
              <td class="align-middle text-primary">
                <strong>2526-0009</strong>
              </td>
              <td class="align-middle">
                <div class="d-flex align-items-center">
                  <div
                    class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mr-2 font-weight-bold"
                    style="width: 35px; height: 35px">
                    SB
                  </div>
                  <div>
                    <strong>Santri Baru</strong>
                    <small class="d-block text-muted">081234567890</small>
                  </div>
                </div>
              </td>
              <td class="align-middle">Laki-Laki</td>
              <td class="align-middle">
                <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                  <i class="fas fa-clock text-warning mr-2"></i>Menunggu
                  Persyaratan
                </span>
              </td>
              <td class="align-middle">-</td>
              <td class="align-middle">
                <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                  <i class="fas fa-times-circle text-danger mr-2"></i>Belum
                  Diverifikasi
                </span>
              </td>
              <td class="align-middle">
                <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                  <i class="fas fa-exclamation-circle text-warning mr-2"></i>Belum Disinkron
                </span>
              </td>
              <td class="text-center align-middle">
                <button class="btn btn-sm btn-outline-primary"
                  onclick="window.location.href='DetailPendaftaran.html?id=2'">
                  <i class="fas fa-info-circle mr-1"></i> Detail
                </button>
              </td>
            </tr>

            <!-- Data Dummy 3 -->
            <tr data-id="3" data-unit="SD" data-jenis="Daftar Baru" data-status="Menunggu Persyaratan"
              data-verifikasi="sudah" data-sinkron="sudah">
              <td class="text-center align-middle" style="width: 50px">
                <div class="d-flex justify-content-center align-items-center">
                  <input type="checkbox" class="form-check-input row-check m-0" data-id="3" />
                </div>
              </td>
              <td class="align-middle">3</td>
              <td class="align-middle">
                <span class="badge badge-danger badge-pill px-3 py-2">SD</span>
              </td>
              <td class="align-middle text-primary">
                <strong>2526-0008</strong>
              </td>
              <td class="align-middle">
                <div class="d-flex align-items-center">
                  <div
                    class="rounded-circle bg-info text-white d-flex align-items-center justify-content-center mr-2 font-weight-bold"
                    style="width: 35px; height: 35px">
                    YF
                  </div>
                  <div>
                    <strong>Yusuf</strong>
                    <small class="d-block text-muted">082345678901</small>
                  </div>
                </div>
              </td>
              <td class="align-middle">Laki-Laki</td>
              <td class="align-middle">
                <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                  <i class="fas fa-clock text-warning mr-2"></i>Menunggu
                  Persyaratan
                </span>
              </td>
              <td class="align-middle">1 A</td>
              <td class="align-middle">
                <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                  <i class="fas fa-check-circle text-success mr-2"></i>Sudah
                  Diverifikasi
                </span>
              </td>
              <td class="align-middle">
                <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                  <i class="fas fa-check-circle text-success mr-2"></i>Sudah
                  Disinkron
                </span>
              </td>
              <td class="text-center align-middle">
                <button class="btn btn-sm btn-outline-primary"
                  onclick="window.location.href='DetailPendaftaran.html?id=3'">
                  <i class="fas fa-info-circle mr-1"></i> Detail
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- FORM PROSES -->
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <h5 class="font-weight-bold text-primary mb-3">
          <i class="fas fa-cogs text-success mr-2"></i>Proses Sinkronisasi
        </h5>
        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="font-weight-bold">Perbarui Status Pendaftaran</label>
            <select class="custom-select" id="statusPendaftaran">
              <option value="">-- Pilih Status --</option>
              <optgroup label="Hasil Keputusan">
                <option value="7">Diterima</option>
                <option value="9">Cadangan</option>
              </optgroup>
              <optgroup label="Tahapan Berikutnya">
                <option value="10">Daftar Ulang</option>
                <option value="11">Telah Daftar Ulang</option>
              </optgroup>
              <optgroup label="Selesai Tahapan">
                <option value="12">Peserta Didik Baru</option>
              </optgroup>
            </select>
          </div>
          <div class="col-md-4 mb-3">
            <label class="font-weight-bold">Tempatkan Pada Kelas</label>
            <select class="custom-select" id="pilihKelas" disabled>
              <option value="">-- Pilih Kelas --</option>
              <option value="1A">1 A</option>
              <option value="1B">1 B</option>
              <option value="7A">7 A</option>
              <option value="7B">7 B</option>
              <option value="10A">10 A</option>
              <option value="10B">10 B</option>
            </select>
            <div class="form-check mt-2">
              <input type="checkbox" class="form-check-input" id="kelasOtomatis" />
              <label class="form-check-label" for="kelasOtomatis">
                Tetapkan kelas otomatis sesuai kelas sementara
              </label>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <label class="font-weight-bold">Setelan Awalan Nomor Induk</label>
            <input type="text" class="form-control" id="nomorInduk" placeholder="Contoh: 2025" maxlength="32" />
            <div class="form-check mt-2">
              <input type="checkbox" class="form-check-input" id="nomorOtomatis" />
              <label class="form-check-label" for="nomorOtomatis">
                Gunakan nomor pendaftaran sebagai nomor induk
              </label>
            </div>
          </div>
        </div>

        <div class="alert alert-info" role="alert" id="infoAlert" style="display: none">
          <i class="fas fa-info-circle mr-2"></i>
          <span id="infoText"></span>
        </div>

        <button class="btn btn-success px-5 mt-3" id="btnProsesSinkron">
          <i class="fas fa-sync-alt mr-2"></i>Sinkronkan Data Terpilih
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Loading -->
  <div class="modal fade" id="loadingModal" data-backdrop="static" data-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body text-center py-4">
          <div class="spinner-border text-primary mb-3" role="status">
            <span class="sr-only">Loading...</span>
          </div>
          <p class="mb-0 text-muted">Sedang memproses data...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-white py-3 mt-5">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12 text-center">
          <p class="mb-0 text-muted">Powered By PPDB &copy; 2022-2025</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    fetch("../../Navbar/navbar.html")
      .then(res => res.text())
      .then(html => {
        const navbar = document.getElementById("navbar");
        navbar.innerHTML = html;

        // Menjalankan ulang semua script yang ada di navbar.html
        navbar.querySelectorAll("script").forEach(oldScript => {
          const newScript = document.createElement("script");
          if (oldScript.src) {
            newScript.src = oldScript.src;
          } else {
            newScript.innerHTML = oldScript.innerHTML;
          }
          document.body.appendChild(newScript);
        });

        // PANGGIL FUNGSI ACTIVE STATE SETELAH NAVBAR LOADED
        // Tunggu 200ms untuk memastikan semua script navbar selesai
        setTimeout(function () {
          setActiveNavbar();
        }, 200);
      });

    // Check all checkbox
    document
      .getElementById("checkAll")
      .addEventListener("change", function () {
        const checkboxes = document.querySelectorAll(".row-check");
        checkboxes.forEach((cb) => (cb.checked = this.checked));
        updateInfoAlert();
      });

    // Update info alert saat checkbox berubah
    document.addEventListener("change", function (e) {
      if (e.target.classList.contains("row-check")) {
        updateInfoAlert();
      }
    });

    function updateInfoAlert() {
      const checked = document.querySelectorAll(".row-check:checked").length;
      const infoAlert = document.getElementById("infoAlert");
      const infoText = document.getElementById("infoText");

      if (checked > 0) {
        infoAlert.style.display = "block";
        infoText.textContent = `${checked} data terpilih untuk disinkronkan`;
      } else {
        infoAlert.style.display = "none";
      }
    }

    // Filter functionality
    document
      .getElementById("btnTerapkanFilter")
      .addEventListener("click", function () {
        const unit = document.getElementById("filterUnit").value;
        const jenis = document.getElementById("filterJenis").value;
        const status = document.getElementById("filterStatus").value;
        const verifikasi = document.getElementById("filterVerifikasi").value;
        const sinkron = document.getElementById("filterSinkron").value;

        const rows = document.querySelectorAll("#tableBody tr");
        let visibleCount = 0;

        rows.forEach((row) => {
          const rowUnit = row.getAttribute("data-unit");
          const rowJenis = row.getAttribute("data-jenis");
          const rowStatus = row.getAttribute("data-status");
          const rowVerifikasi = row.getAttribute("data-verifikasi");
          const rowSinkron = row.getAttribute("data-sinkron");

          const matchUnit = !unit || rowUnit === unit;
          const matchJenis = !jenis || rowJenis === jenis;
          const matchStatus = !status || rowStatus === status;
          const matchVerifikasi = !verifikasi || rowVerifikasi === verifikasi;
          const matchSinkron = !sinkron || rowSinkron === sinkron;

          if (
            matchUnit &&
            matchJenis &&
            matchStatus &&
            matchVerifikasi &&
            matchSinkron
          ) {
            row.style.display = "";
            visibleCount++;
          } else {
            row.style.display = "none";
          }
        });

        document.getElementById(
          "totalData"
        ).textContent = `Total: ${visibleCount} data`;
        document.getElementById("checkAll").checked = false;
        updateInfoAlert();
      });

    // Reset filter
    document
      .getElementById("btnResetFilter")
      .addEventListener("click", function () {
        document.getElementById("filterUnit").value = "";
        document.getElementById("filterJenis").value = "";
        document.getElementById("filterStatus").value = "";
        document.getElementById("filterVerifikasi").value = "";
        document.getElementById("filterSinkron").value = "";

        const rows = document.querySelectorAll("#tableBody tr");
        rows.forEach((row) => (row.style.display = ""));

        document.getElementById(
          "totalData"
        ).textContent = `Total: ${rows.length} data`;
        document.getElementById("checkAll").checked = false;
        updateInfoAlert();
      });

    // Toggle kelas otomatis
    document
      .getElementById("kelasOtomatis")
      .addEventListener("change", function () {
        document.getElementById("pilihKelas").disabled = this.checked;
        if (this.checked) {
          document.getElementById("pilihKelas").value = "";
        }
      });

    // Toggle nomor otomatis
    document
      .getElementById("nomorOtomatis")
      .addEventListener("change", function () {
        document.getElementById("nomorInduk").disabled = this.checked;
        if (this.checked) {
          document.getElementById("nomorInduk").value = "";
        }
      });

    // Proses sinkron
    document
      .getElementById("btnProsesSinkron")
      .addEventListener("click", function () {
        const selected = document.querySelectorAll(".row-check:checked");

        if (selected.length === 0) {
          alert("⚠️ Pilih minimal satu data untuk disinkronkan!");
          return;
        }

        // Show loading modal
        $("#loadingModal").modal("show");

        // Simulasi proses
        setTimeout(() => {
          $("#loadingModal").modal("hide");

          // Update status sinkron untuk data terpilih
          selected.forEach((checkbox) => {
            const row = checkbox.closest("tr");
            row.setAttribute("data-sinkron", "sudah");

            const statusCell = row.querySelector("td:nth-child(10)");
            statusCell.innerHTML = `
            <span class="badge badge-success">
              <i class="fas fa-check-circle"></i>
              Sudah Disinkron
            </span>
          `;

            checkbox.checked = false;
          });

          document.getElementById("checkAll").checked = false;
          updateInfoAlert();

          // Success alert
          const successDiv = document.createElement("div");
          successDiv.className =
            "alert alert-success alert-dismissible fade show";
          successDiv.innerHTML = `
          <strong><i class="fas fa-check-circle mr-2"></i>Berhasil!</strong> 
          ${selected.length} data berhasil disinkronkan.
          <button type="button" class="close" data-dismiss="alert">&times;</button>
        `;
          document
            .querySelector(".container-fluid")
            .insertBefore(
              successDiv,
              document.querySelector(".container-fluid").firstChild
            );

          // Auto dismiss after 5 seconds
          setTimeout(() => successDiv.remove(), 5000);
        }, 2000);
      });

    // Toggle filter collapse icon
    $("#filterCollapse")
      .on("shown.bs.collapse", function () {
        document.getElementById("filterIcon").className = "fas fa-chevron-up";
      })
      .on("hidden.bs.collapse", function () {
        document.getElementById("filterIcon").className =
          "fas fa-chevron-down";
      });

    // Input nomor induk hanya angka
    document
      .getElementById("nomorInduk")
      .addEventListener("input", function (e) {
        this.value = this.value.replace(/[^\d]/g, "");
      });
  </script>
</body>

</html>