<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #3d5ce6 0%, #3f8cf0 100%);">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="/PPDB/index.html">
            <div class="bg-white rounded-circle d-flex align-items-center justify-content-center mr-2"
                style="width: 40px; height: 40px;">
                <i class="fas fa-graduation-cap" style="color: #3d5ce6;"></i>
            </div>
            <div>
                <span class="font-weight-bold d-block">PPDB </span>
                <small class="d-none d-md-block" style="font-size: 0.7rem; opacity: 0.9;">Solusi Sistem PPDB
                    Sekolah</small>
            </div>
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#topbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="topbarNav">
            <ul class="navbar-nav mx-auto">
                <li class="nav-item">
                    <a class="nav-link text-white" href="/PPDB/Beranda/Beranda.html">
                        <i class="fas fa-home mr-1"></i>Beranda
                    </a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" data-toggle="dropdown">
                        <i class="fas fa-dollar-sign mr-1"></i>Pembayaran
                        <span class="badge badge-danger badge-pill ml-1">10+</span>
                    </a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/PPDB/Pembayaran/ProsesPembayaran.html"><i
                                class="fas fa-arrow-right text-primary mr-2"></i>Proses
                            Pembayaran</a>
                        <a class="dropdown-item" href="/PPDB/Pembayaran/VerifikasiPembayaran.html">
                            <i class="fas fa-check-circle text-success mr-2"></i>Verifikasi Pembayaran</a>
                    </div>
                </li>

                <li class="nav-item">
                    <a class="nav-link text-white" href="/PPDB/Tagihan/Tagihan.html"><i
                            class="fas fa-tags mr-1"></i>Tagihan</a>
                </li>

                <li class="nav-item dropdown">
                    <a class="dropdown-toggle nav-link text-white" href="#" data-toggle="dropdown">
                        <i class="fas fa-chart-bar mr-1"></i>Rekap
                    </a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/PPDB/DataRekap/Transaksi.html"><i
                                class="fas fa-exchange-alt text-info mr-2"></i>Transaksi</a>
                        <a class="dropdown-item" href="/PPDB/DataRekap/Aruskas.html">
                            <i class="fas fa-wallet text-warning mr-2"></i>Arus
                            Kas</a>
                        <a class="dropdown-item" href="#"><i class="fas fa-print text-secondary mr-2"></i>Cetak
                            Laporan</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" data-toggle="dropdown">
                        <i class="fas fa-database mr-1"></i>Data Master
                    </a>
                    <div class="dropdown-menu">

                        <a class="dropdown-item" href="/PPDB/DataMaster/DataPetugas.html">
                            <i class="fas fa-users text-primary mr-2"></i>Data Petugas
                        </a>

                        <a class="dropdown-item" href="/PPDB/DataMaster/DataUnit.html">
                            <i class="fas fa-building text-info mr-2"></i>Data Unit
                        </a>

                        <a class="dropdown-item" href="/PPDB/DataMaster/DataTahun.html">
                            <i class="fas fa-calendar text-warning mr-2"></i>Data Tahun
                        </a>

                        <a class="dropdown-item" href="/PPDB/DataMaster/DataKelas.html">
                            <i class="fas fa-school text-success mr-2"></i>Data Kelas
                        </a>

                        <a class="dropdown-item" href="/PPDB/DataMaster/DataSiswa.html">
                            <i class="fas fa-user-graduate text-danger mr-2"></i>Data Siswa
                        </a>

                        <a class="dropdown-item" href="/PPDB/DataMaster/DataAkun.html">
                            <i class="fas fa-id-card text-secondary mr-2"></i>Data Akun
                        </a>

                        <a class="dropdown-item" href="/PPDB/DataMaster/DataKategori.html">
                            <i class="fas fa-tags text-primary mr-2"></i>Data Kategori
                        </a>

                        <a class="dropdown-item" href="/PPDB/DataMaster/DataRekening.html">
                            <i class="fas fa-university text-info mr-2"></i>Data Rekening
                        </a>

                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" id="presensiDropdown" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-clipboard-check mr-2"></i> Presensi
                    </a>

                    <div class="dropdown-menu" aria-labelledby="presensiDropdown">

                        <!-- Level 2: Absensi Saya -->
                        <div class="dropdown-submenu dropright">
                            <a class="dropdown-item dropdown-toggle" href="#">
                                <i class="fas fa-user-check mr-2"></i> Absensi Saya
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="/PPDB/Absensi/RekamMandiri.html">
                                    <i class="fas fa-edit mr-2"></i> Rekam Mandiri
                                </a>
                                <a class="dropdown-item" href="/PPDB/Absensi/RiwayatAbsensi.html">
                                    <i class="fas fa-history mr-2"></i> Riwayat Absensi
                                </a>
                            </div>
                        </div>

                        <!-- Level 2: Rekap Absensi -->
                        <div class="dropdown-submenu dropright">
                            <a class="dropdown-item dropdown-toggle" href="#">
                                <i class="fas fa-list-alt mr-2"></i> Rekap Absensi
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="/PPDB/Absensi/AbsensiPetugas.html">
                                    <i class="fas fa-user-tie mr-2"></i> Absensi Petugas
                                </a>
                                <a class="dropdown-item" href="/PPDB/Absensi/AbsensiSiswa.html">
                                    <i class="fas fa-user-graduate mr-2"></i> Absensi Siswa
                                </a>
                            </div>
                        </div>

                        <!-- Level 2: Pengaturan Absensi -->
                        <div class="dropdown-submenu dropright">
                            <a class="dropdown-item dropdown-toggle" href="#">
                                <i class="fas fa-cog mr-2"></i> Pengaturan Absensi
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="/PPDB/Absensi/PengaturanUmum.html">
                                    <i class="fas fa-sliders-h mr-2"></i> Pengaturan Umum
                                </a>
                                <a class="dropdown-item" href="/PPDB/Absensi/PengaturanMapel.html">
                                    <i class="fas fa-book mr-2"></i> Pengaturan Mapel
                                </a>
                            </div>
                        </div>

                    </div>
                </li>

                <li class="nav-item">
                    <a class="nav-link text-white" href="/PPDB/Tabungan/Tabungan.html"><i
                            class="fas fa-piggy-bank mr-1"></i>Tabungan</a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" data-toggle="dropdown">
                        <i class="fas fa-user-plus mr-1"></i>PPDB
                    </a>
                    <div class="dropdown-menu shadow-sm border-0 ">
                        <a class="dropdown-item d-flex align-items-center font-weight-bold "
                            href="/PPDB/DataPendaftar/DataPendaftar.html">
                            <i class="fas fa-users mr-2 text-primary"></i>
                            Data Pendaftar
                        </a>
                        <a class="dropdown-item d-flex align-items-center" href="/PPDB/DataTagihan/DataTagihan.html">
                            <i class="fas fa-file-invoice-dollar mr-2 text-primary"></i>
                            Data Tagihan
                        </a>
                        <a class="dropdown-item bg-light d-flex align-items-center"
                            href="/PPDB/DataBerkas/Data_Berkas.html">
                            <i class="fas fa-folder-open mr-2 text-primary"></i>
                            Data Berkas
                        </a>
                        <a class="dropdown-item d-flex align-items-center" href="/PPDB/DataPeriode/DataPeriode.html">
                            <i class="fas fa-calendar-alt mr-2 text-success"></i>
                            Data Periode
                        </a>
                        <a class="dropdown-item d-flex align-items-center"
                            href="/PPDB/DataInformasi/DataInformasi.html">
                            <i class="fas fa-info-circle mr-2 text-warning"></i>
                            Data Informasi
                        </a>
                        <a class="dropdown-item d-flex align-items-center" href="/PPDB/AksesPortal/HalamanUtama.html">
                            <i class="fas fa-user-lock mr-2 text-danger"></i>
                            Akses Portal
                        </a>
                        <div class="dropdown-divider"></div>

                        <div class="dropright">
                            <a class="dropdown-item dropdown-toggle" href="#" id="submenuDropdown"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-cogs mr-2"></i> Pengaturan PPDB
                            </a>

                            <div class="dropdown-menu" aria-labelledby="submenuDropdown">
                                <a class="dropdown-item" href="/PPDB/Pengaturan/PengaturanUmum.html">Pengaturan
                                    Umum</a>
                                <a class="dropdown-item" href="/PPDB/Pengaturan/PengaturanBiaya.html">Pengaturan
                                    Biaya</a>
                                <a class="dropdown-item" href="/PPDB/Pengaturan/PengaturanFormulir.html">Pengaturan
                                    Formulir</a>
                                <a class="dropdown-item" href="/PPDB/Pengaturan/PengaturanBidang.html">Pengaturan
                                    Bidang</a>
                                <a class="dropdown-item" href="/PPDB/Pengaturan/PengaturanBerkas.html">Pengaturan
                                    Berkas</a>
                                <a class="dropdown-item" href="/PPDB/Pengaturan/PengaturanNotifikasi.html">Pengaturan
                                    Notifikasi</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Pengaturan/PengaturanKomponen/JalurPendaftaran.html">Pengaturan
                                    Komponen</a>
                                <a class="dropdown-item" href="/PPDB/Pengaturan/PengaturanKontak.html">Pengaturan
                                    Kontak</a>
                            </div>
                        </div>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="dropdown-toggle nav-link text-white" href="#" data-toggle="dropdown">
                        <i class="fas fa-store mr-1"></i>e-Kantin
                    </a>

                    <div class="dropdown-menu shadow-sm border-0">

                        <a class="dropdown-item d-flex align-items-center" href="/PPDB/eKantin/DataMerchant.html">
                            <i class="fas fa-store mr-2 text-primary"></i>
                            Data Merchant
                        </a>

                        <a class="dropdown-item d-flex align-items-center" href="/PPDB/eKantin/RiwayatTransaksi.html">
                            <i class="fas fa-receipt mr-2 text-info"></i>
                            Riwayat Transaksi
                        </a>

                        <a class="dropdown-item d-flex align-items-center" href="/PPDB/eKantin/PenarikanDana.html">
                            <i class="fas fa-money-bill-wave mr-2 text-success"></i>
                            Penarikan Dana
                        </a>

                        <a class="dropdown-item d-flex align-items-center" href="https://demo.schoolpay.co.id/e-kantin"
                            target="_blank">
                            <i class="fas fa-external-link-alt mr-2 text-warning"></i>
                            Akses Halaman
                        </a>

                        <div class="dropdown-divider"></div>

                        <div class="dropright dropdown">
                            <a class="dropdown-item dropdown-toggle d-flex align-items-center" href="#"
                                id="submenuEKantin" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-cog mr-2 text-secondary"></i>
                                Pengaturan e-Kantin
                            </a>

                            <div class="dropdown-menu" aria-labelledby="submenuEKantin">
                                <a class="dropdown-item d-flex align-items-center"
                                    href="/PPDB/eKantin/PengaturanUmum.html">
                                    <i class="fas fa-sliders-h mr-2 text-primary"></i>
                                    Pengaturan Umum
                                </a>

                                <a class="dropdown-item d-flex align-items-center"
                                    href="/PPDB/eKantin/PengaturanTransaksi.html">
                                    <i class="fas fa-random mr-2 text-info"></i>
                                    Pengaturan Transaksi
                                </a>
                            </div>
                        </div>
                    </div>
                </li>

                <!-- MENU LAINNYA -->
                <li class="nav-item dropdown">
                    <a class="dropdown-toggle nav-link text-white" href="#"
                        data-toggle="dropdown">
                        <i class="fas fa-cog mr-1"></i>Lainnya
                    </a>

                    <div class="dropdown-menu dropdown-menu-right">

                        <!-- SUBMENU PENGATURAN APLIKASI -->
                        <div class="dropstart-js dropdown">
                            <a class="dropdown-item dropdown-toggle d-flex align-items-center justify-content-between"
                                href="#" id="menuApp">
                                <span class="d-flex align-items-center">
                                    <i class="fas fa-tools text-primary mr-2"></i>
                                    Pengaturan Aplikasi
                                </span>
                                <i class="fas fa-angle-left text-secondary ml-2 submenu-arrow"></i>
                            </a>

                            <div class="dropdown-menu">
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/PengaturanAplikasi/PengaturanUmumLainnya.html">Pengaturan
                                    Umum</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/PengaturanAplikasi/PengaturanTampilan.html">Pengaturan
                                    Tampilan</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/PengaturanAplikasi/PengaturanSistem.html">Pengaturan Sistem</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/PengaturanAplikasi/PengaturanFitur.html">Pengaturan
                                    Fitur</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/PengaturanAplikasi/PengaturanPembayaran.html">Pengaturan
                                    Pembayaran</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/PengaturanAplikasi/PengaturanServerAPI.html">Pengaturan Server
                                    API</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/PengaturanAplikasi/PengaturanNotifikasi.html">Pengaturan
                                    Notifikasi</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/PengaturanAplikasi/PengaturanLisensi.html">Pengaturan
                                    Lisensi</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/PengaturanAplikasi/PencadanganData.html">Pencadangan Data</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/PengaturanAplikasi/ModePemeliharaan.html">Mode
                                    Pemeliharaan</a>
                            </div>
                        </div>

                        <!-- SUBMENU PERALATAN -->
                        <div class="dropstart-js dropdown mt-1">
                            <a class="dropdown-item dropdown-toggle d-flex align-items-center" href="#" id="menuTools">
                                <span class="d-flex align-items-center">
                                    <i class="fas fa-wrench text-warning mr-2"></i>
                                    Peralatan
                                </span>
                                <i class="fas fa-angle-left text-secondary ml-auto"></i>
                            </a>

                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="/PPDB/Lainnya/Peralatan/PusatInformasi.html">Pusat
                                    Informasi</a>
                                <a class="dropdown-item" href="/PPDB/Lainnya/Peralatan/PengingatTagihan.html">Pengingat
                                    Tagihan</a>
                                <a class="dropdown-item"
                                    href="/PPDB/Lainnya/Peralatan/MonitoringAntrian.html">Monitoring
                                    Antrean</a>
                                <a class="dropdown-item" href="/PPDB/Lainnya/Peralatan/PencadanganData.html">Pencadangan
                                    Data</a>
                                <a class="dropdown-item" href="/PPDB/Lainnya/Peralatan/InformasiServer.html">Informasi
                                    Server</a>
                                <a class="dropdown-item" href="/PPDB/Lainnya/Peralatan/LogAktivitas.html">Log
                                    Aktivitas</a>
                            </div>
                        </div>

                    </div>
                </li>
            </ul>

            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" data-toggle="dropdown">
                        <div class="bg-white rounded-circle d-flex align-items-center justify-content-center"
                            style="width: 35px; height: 35px;">
                            <i class="fas fa-user" style="color: #3d5ce6;"></i>
                        </div>
                        <span class="ml-2 d-none d-lg-inline text-white">Admin Operator</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <div class="px-3 py-2 border-bottom">
                            <small class="text-muted d-block">Logged in as</small>
                            <strong>Admin Operator</strong>
                            <small class="text-muted d-block">NIP 20250601001</small>
                        </div>
                        <a class="dropdown-item" href="#"><i class="fas fa-user-circle text-primary mr-2"></i>Profil
                            Akun</a>
                        <a class="dropdown-item" href="#"><i class="fas fa-key text-warning mr-2"></i>Kata Sandi</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item text-danger" href="#"><i class="fas fa-sign-out-alt mr-2"></i>Keluar
                            Akun</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>


<script>

    // Toggle level 1 (Presensi)
    $('#presensiDropdown').on('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        var $dropdownMenu = $(this).next('.dropdown-menu');

        // tutup semua submenu level 2 saat toggle level 1
        $dropdownMenu.find('.dropdown-menu').hide();

        // toggle level 1
        $dropdownMenu.toggle();
    });

    // Toggle submenu level 2
    $('.dropright > .dropdown-toggle').on('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        var $submenu = $(this).next('.dropdown-menu');

        if ($submenu.is(':visible')) {
            $submenu.hide(); // tutup submenu
        } else {
            // tutup submenu lain di level yang sama
            $(this).closest('.dropdown-menu').find('.dropdown-menu').not($submenu).hide();
            $submenu.show(); // buka submenu
        }
    });

    $(document).on('click', function (e) {
        if (
            !$(e.target).closest('.dropdown').length &&
            !$(e.target).hasClass('dropdown-toggle')
        ) {
            $('.dropdown-menu').removeClass('show');
        }
    });

    function setActiveNavbar() {
        const currentPath = window.location.pathname;

        console.log('üîç Current path:', currentPath);

        // Reset semua menu ke state default (text-white)
        $('.navbar-nav > .nav-item > .nav-link').each(function () {
            $(this).removeClass('bg-white text-primary font-weight-bold rounded');
            $(this).addClass('text-white');
        });

        // Ekstrak folder dari current path
        // Contoh: /PPDB/DataPendaftar/DetailPendaftar.html ‚Üí folder = DataPendaftar
        function getCurrentFolder(path) {
            const parts = path.split('/').filter(p => p && p !== 'PPDB');
            return parts.length > 0 ? parts[0] : '';
        }

        // Ekstrak folder dari href
        function getHrefFolder(href) {
            if (!href || href === '#') return '';
            const parts = href.split('/').filter(p => p && p !== 'PPDB');
            return parts.length > 0 ? parts[0] : '';
        }

        // Fungsi untuk normalize dan compare path
        function isPathMatch(href, path) {
            if (!href || href === '#') return false;

            // Hilangkan /PPDB dari kedua path untuk compare
            const normalizedHref = href.replace(/^\/PPDB/, '').toLowerCase();
            const normalizedPath = path.replace(/^\/PPDB/, '').toLowerCase();

            // 1. Exact match (paling prioritas)
            if (normalizedPath === normalizedHref) {
                console.log('  ‚úì Exact match:', href);
                return true;
            }

            // 2. Folder match - cek apakah file ada di folder yang sama
            const currentFolder = getCurrentFolder(path);
            const hrefFolder = getHrefFolder(href);

            if (currentFolder && hrefFolder && currentFolder === hrefFolder) {
                console.log('  ‚úì Folder match:', currentFolder, '=', hrefFolder);
                return true;
            }

            // 3. Partial match untuk file di subfolder
            // Contoh: /DataPendaftar/DetailPendaftar.html matches /DataPendaftar/
            if (normalizedPath.includes('/' + hrefFolder + '/') && hrefFolder.length > 3) {
                console.log('  ‚úì Subfolder match:', href);
                return true;
            }

            return false;
        }

        let menuFound = false;
        const currentFolder = getCurrentFolder(currentPath);

        // Loop semua menu navbar
        $('.navbar-nav > .nav-item').each(function () {
            const $navItem = $(this);
            const $navLink = $navItem.find('> .nav-link');
            const mainHref = $navLink.attr('href');

            // Cek apakah ini dropdown menu
            if ($navItem.hasClass('dropdown')) {
                let hasActiveChild = false;

                // Cek semua sub-menu di dalam dropdown
                $navItem.find('.dropdown-item').each(function () {
                    const dropdownHref = $(this).attr('href');

                    if (isPathMatch(dropdownHref, currentPath)) {
                        hasActiveChild = true;
                        console.log('  ‚úÖ Active menu found:', $navLink.text().trim());
                        return false; // break loop
                    }
                });

                // Jika ada child yang match, highlight parent dropdown
                if (hasActiveChild) {
                    $navLink.removeClass('text-white');
                    $navLink.addClass('bg-white text-primary font-weight-bold rounded');
                    menuFound = true;
                }
            } else {
                // Menu biasa (bukan dropdown)
                if (isPathMatch(mainHref, currentPath)) {
                    $navLink.removeClass('text-white');
                    $navLink.addClass('bg-white text-primary font-weight-bold rounded');
                    console.log('  ‚úÖ Active menu found:', $navLink.text().trim());
                    menuFound = true;
                }
            }
        });

        // Special case: Beranda/Home page
        if (currentPath.includes('Beranda.html') ||
            currentPath.includes('index.html') ||
            currentPath.endsWith('/PPDB/') ||
            currentPath.endsWith('/PPDB')) {

            // Reset semua dulu
            $('.navbar-nav > .nav-item > .nav-link').each(function () {
                $(this).removeClass('bg-white text-primary font-weight-bold rounded');
                $(this).addClass('text-white');
            });

            // Set Beranda sebagai aktif
            $('a.nav-link[href*="Beranda"]').each(function () {
                $(this).removeClass('text-white');
                $(this).addClass('bg-white text-primary font-weight-bold rounded');
            });

            console.log('  ‚úÖ Beranda active');
            menuFound = true;
        }

        if (menuFound) {
            console.log('‚úÖ Active navbar set successfully for folder:', currentFolder);
        } else {
            console.log('‚ö†Ô∏è No matching menu found');
            console.log('   Current folder:', currentFolder);
            console.log('   Tip: Make sure navbar menu has a link with folder name:', currentFolder);
        }
    }
</script>