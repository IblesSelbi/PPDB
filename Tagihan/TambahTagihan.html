<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Tambah Tagihan Siswa :: School Payment App</title>

    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tom Select CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.bootstrap4.min.css">
</head>

<body style="font-family: 'Inter', sans-serif; background-color: #f5f5f5;">

    <!-- NAVBAR -->
    <div id="navbar"></div>

    <!-- MAIN CONTENT -->
    <div class="container-fluid py-4">

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb bg-white px-3 mb-2">
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none">Beranda</a></li>
                <li class="breadcrumb-item"><a href="Tagihan.html" class="text-decoration-none">Tagihan</a></li>
                <li class="breadcrumb-item active">Tambah Tagihan</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="font-weight-bold mb-1">Tambah Tagihan</h2>
                <p class="text-muted mb-0"><i class="fas fa-info-circle mr-1"></i>Form untuk menambahkan tagihan baru
                    kepada siswa</p>
            </div>
            <div>
                <a href="DetailDaftarTagihan.html" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left mr-2"></i>Kembali
                </a>
            </div>
        </div>

        <!-- Alert -->
        <div id="alert" class="alert alert-dismissible fade" role="alert"
            style="display: none; border-left: 4px solid #667eea;">
            <div class="d-flex align-items-center">
                <div class="mr-3">
                    <i id="alert-icon" class="fas fa-info-circle fa-2x text-primary"></i>
                </div>
                <div class="flex-grow-1">
                    <h6 id="alert-title" class="alert-heading font-weight-bold mb-1">Informasi</h6>
                    <div id="alert-content" class="mb-0"></div>
                </div>
            </div>
            <button type="button" class="close" onclick="hideAlert()">
                <span>&times;</span>
            </button>
        </div>

        <!-- Form Card -->
        <div class="row">
            <div class="col-lg-8">
                <div class="card shadow">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0 font-weight-bold">
                            <i class="fas fa-edit text-primary mr-2"></i>Form Tambah Tagihan
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="form" action="javascript:void(0)">

                            <!-- Pilihan Unit -->
                            <div class="form-group">
                                <label class="font-weight-bold">Pilihan Unit <span class="text-danger">*</span></label>
                                <select name="unit" id="unit" class="form-control">
                                    <option value="">-- Pilih Unit --</option>
                                    <option value="SD" selected>SD</option>
                                    <option value="SMP">SMP</option>
                                    <option value="SMA">SMA</option>
                                </select>
                                <small id="unit-feedback" class="form-text text-danger" style="display: none;"></small>
                            </div>

                            <!-- Pilihan Kelas -->
                            <div id="select-classroom" style="display: none;">
                                <div class="form-group">
                                    <label class="font-weight-bold">Pilihan Kelas</label>
                                    <div class="custom-control custom-switch">
                                        <input type="checkbox" class="custom-control-input" id="input-select-classroom">
                                        <label class="custom-control-label" for="input-select-classroom">Memilih kelas
                                            tertentu</label>
                                    </div>
                                    <small class="form-text text-muted">Aktifkan untuk memilih kelas tertentu yang akan
                                        dikenakan tagihan</small>
                                </div>

                                <div id="table-select-classroom" class="mb-3" style="display: none;">
                                    <button type="button" id="classroom-bulk-action"
                                        class="btn btn-sm btn-secondary mb-2" style="display: none;">
                                        <i class="fas fa-tasks mr-1"></i>Aksi Terpilih
                                    </button>

                                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                        <table class="table table-hover table-sm table-bordered mb-0">
                                            <thead class="bg-light" style="position: sticky; top: 0; z-index: 1;">
                                                <tr>
                                                    <th class="text-center align-middle p-2" style="width:35px;">
                                                        <div class="d-flex justify-content-center align-items-center">
                                                            <input type="checkbox" id="classroom-checks"
                                                                class="form-check-input"
                                                                style="cursor:pointer;margin:0;">
                                                        </div>
                                                    </th>
                                                    <th class="text-center align-middle p-2" style="width:40px;">#</th>
                                                    <th class="align-middle p-2">Kode Kelas</th>
                                                    <th class="align-middle p-2">Nama Kelas</th>
                                                    <th class="align-middle p-2">Tahun Ajaran</th>
                                                    <th class="text-center align-middle p-2" style="width:100px;">Status
                                                    </th>
                                                    <th class="text-center align-middle p-2" style="width:100px;">Jml.
                                                        Siswa</th>
                                                </tr>
                                            </thead>
                                            <tbody id="classroom-list">
                                                <tr>
                                                    <td colspan="7" class="text-center py-3">
                                                        <i class="fas fa-spinner fa-spin text-primary"></i>
                                                        <p class="mb-0 text-muted mt-2 small">Memuat data kelas...</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Pilihan Siswa -->
                            <div id="select-student" style="display: none;">
                                <div class="form-group">
                                    <label class="font-weight-bold">Pilihan Siswa</label>
                                    <div class="custom-control custom-switch">
                                        <input type="checkbox" class="custom-control-input" id="input-select-student">
                                        <label class="custom-control-label" for="input-select-student">Memilih siswa
                                            tertentu</label>
                                    </div>
                                    <small class="form-text text-muted">Aktifkan untuk memilih siswa tertentu dari kelas
                                        yang dipilih</small>
                                </div>

                                <div id="table-select-student" class="mb-3" style="display: none;">
                                    <button type="button" id="student-bulk-action" class="btn btn-sm btn-secondary mb-2"
                                        style="display: none;">
                                        <i class="fas fa-tasks mr-1"></i>Aksi Terpilih
                                    </button>

                                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                        <table class="table table-hover table-sm table-bordered mb-0">
                                            <thead class="bg-light" style="position: sticky; top: 0; z-index: 1;">
                                                <tr>
                                                    <th class="text-center align-middle p-2" style="width:35px;">
                                                        <div class="d-flex justify-content-center align-items-center">
                                                            <input type="checkbox" id="student-checks"
                                                                class="form-check-input"
                                                                style="cursor:pointer;margin:0;">
                                                        </div>
                                                    </th>
                                                    <th class="text-center align-middle p-2" style="width:40px;">#</th>
                                                    <th class="align-middle p-2">Nomor Induk</th>
                                                    <th class="align-middle p-2">Nama Lengkap</th>
                                                    <th class="align-middle p-2">Nama Kelas</th>
                                                    <th class="text-center align-middle p-2" style="width:100px;">Status
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="student-list">
                                                <tr>
                                                    <td colspan="6" class="text-center py-3">
                                                        <i class="fas fa-spinner fa-spin text-primary"></i>
                                                        <p class="mb-0 text-muted mt-2 small">Memuat data siswa...</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Jumlah Periode Tagihan -->
                            <div class="form-group">
                                <label class="font-weight-bold">Jumlah Periode Tagihan <span
                                        class="text-danger">*</span></label>
                                <select name="bill_time" id="bill-time" class="form-control">
                                    <option value="">-- Pilih Periode --</option>
                                    <optgroup label="Bulanan">
                                        <option value="1">1 Bulan</option>
                                        <option value="2">2 Bulan</option>
                                        <option value="3">3 Bulan</option>
                                        <option value="4">4 Bulan</option>
                                        <option value="5">5 Bulan</option>
                                        <option value="6">6 Bulan</option>
                                        <option value="7">7 Bulan</option>
                                        <option value="8">8 Bulan</option>
                                        <option value="9">9 Bulan</option>
                                        <option value="10">10 Bulan</option>
                                        <option value="11">11 Bulan</option>
                                        <option value="12">12 Bulan</option>
                                    </optgroup>
                                    <optgroup label="Tahunan">
                                        <option value="24">2 Tahun</option>
                                        <option value="36">3 Tahun</option>
                                        <option value="48">4 Tahun</option>
                                    </optgroup>
                                </select>
                                <small id="bill-time-feedback" class="form-text text-danger"
                                    style="display: none;"></small>
                            </div>

                            <!-- Bulan dan Tahun Mulai -->
                            <div class="form-group">
                                <label class="font-weight-bold">Bulan dan Tahun Mulai <span
                                        class="text-danger">*</span></label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <select name="bill_month" id="bill-month" class="form-control">
                                            <option value="">-- Pilih Bulan --</option>
                                            <option value="01">Januari</option>
                                            <option value="02">Februari</option>
                                            <option value="03">Maret</option>
                                            <option value="04">April</option>
                                            <option value="05">Mei</option>
                                            <option value="06">Juni</option>
                                            <option value="07">Juli</option>
                                            <option value="08">Agustus</option>
                                            <option value="09">September</option>
                                            <option value="10">Oktober</option>
                                            <option value="11">November</option>
                                            <option value="12">Desember</option>
                                        </select>
                                        <small id="bill-month-feedback" class="form-text text-danger"
                                            style="display: none;"></small>
                                    </div>
                                    <div class="col-md-6">
                                        <select name="bill_year" id="bill-year" class="form-control">
                                            <option value="">-- Pilih Tahun --</option>
                                            <option value="2025">2025</option>
                                            <option value="2026">2026</option>
                                            <option value="2027">2027</option>
                                            <option value="2028">2028</option>
                                            <option value="2029">2029</option>
                                        </select>
                                        <small id="bill-year-feedback" class="form-text text-danger"
                                            style="display: none;"></small>
                                    </div>
                                </div>
                            </div>

                            <!-- Item Tagihan 1 -->
                            <div class="form-group">
                                <label class="font-weight-bold">Item Tagihan 1 <span
                                        class="text-danger">*</span></label>
                                <select name="bill_category_1" id="bill-category-1" class="form-control">
                                    <option value="">-- Pilih Item --</option>
                                    <option value="spp-sd">SPP SD -- Rp 200,000</option>
                                    <option value="spp-smp">SPP SMP -- Rp 200,000</option>
                                    <option value="spp-sma">SPP SMA -- Rp 300,000</option>
                                    <option value="buku-paket">Buku Paket -- Rp 250,000</option>
                                    <option value="seragam-smp">Seragam SMP -- Rp 400,000</option>
                                    <option value="seragam-sma">Seragam SMA -- Rp 500,000</option>
                                </select>
                                <small id="bill-category-1-feedback" class="form-text text-danger"
                                    style="display: none;"></small>
                            </div>

                            <!-- Item Tagihan 2 -->
                            <div class="form-group">
                                <label class="font-weight-bold">Item Tagihan 2</label>
                                <select name="bill_category_2" id="bill-category-2" class="form-control">
                                    <option value="">-- Pilih Item (Opsional) --</option>
                                    <option value="spp-sd">SPP SD -- Rp 200,000</option>
                                    <option value="spp-smp">SPP SMP -- Rp 200,000</option>
                                    <option value="spp-sma">SPP SMA -- Rp 300,000</option>
                                    <option value="buku-paket">Buku Paket -- Rp 250,000</option>
                                    <option value="seragam-smp">Seragam SMP -- Rp 400,000</option>
                                    <option value="seragam-sma">Seragam SMA -- Rp 500,000</option>
                                </select>
                            </div>

                            <!-- Submit Button -->
                            <div class="form-group mb-0">
                                <button type="submit" id="btn-submit" class="btn btn-outline-primary btn-block py-2">
                                    <span id="btn-icon" class="spinner-border spinner-border-sm mr-2"
                                        style="display: none;"></span>
                                    <i id="btn-svg" class="fas fa-check-circle mr-2"></i>
                                    <span id="btn-text">Proses Tambah Tagihan</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Info Card -->
            <div class="col-lg-4">
                <div class="card bg-light border-0 shadow">
                    <div class="card-body">
                        <h5 class="font-weight-bold mb-3">
                            <i class="fas fa-info-circle text-primary mr-2"></i>Informasi
                        </h5>
                        <div class="mb-3">
                            <small class="text-muted d-block mb-1">Panduan Pengisian:</small>
                            <ul class="small mb-0 pl-3">
                                <li>Pilih unit terlebih dahulu</li>
                                <li>Tentukan kelas dan siswa yang akan dikenakan tagihan</li>
                                <li>Tentukan periode tagihan (bulanan/tahunan)</li>
                                <li>Pilih bulan dan tahun mulai tagihan</li>
                                <li>Pilih minimal 1 item tagihan</li>
                            </ul>
                        </div>
                        <div class="alert alert-info mb-0">
                            <i class="fas fa-lightbulb mr-2"></i>
                            <small><strong>Tips:</strong> Gunakan fitur pilih kelas dan siswa untuk tagihan yang lebih
                                spesifik</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white py-3 mt-5">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0 text-muted">Powered By School Payment App &copy; 2022-2025</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery, Popper.js, Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

    <!-- Tom Select -->
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        fetch("../Navbar/navbar.html")
            .then(res => res.text())
            .then(html => {
                const navbar = document.getElementById("navbar");
                navbar.innerHTML = html;

                // Menjalankan ulang semua script yang ada di navbar.html
                navbar.querySelectorAll("script").forEach(oldScript => {
                    const newScript = document.createElement("script");
                    if (oldScript.src) {
                        newScript.src = oldScript.src; // script eksternal
                    } else {
                        newScript.innerHTML = oldScript.innerHTML; // inline script
                    }
                    document.body.appendChild(newScript);
                });
            });
            
        $(document).ready(function () {
            // Initialize Tom Select
            new TomSelect('#unit', {
                placeholder: '-- Pilih Unit --'
            });
            new TomSelect('#bill-category-1', {
                placeholder: '-- Pilih Item --'
            });
            new TomSelect('#bill-category-2', {
                placeholder: '-- Pilih Item (Opsional) --'
            });

            // Handle Unit Change
            $('#unit').on('change', function () {
                const unit = $(this).val();

                if (unit) {
                    $('#select-classroom').show();

                    if ($('#input-select-classroom').is(':checked')) {
                        getClassroom(unit);
                    }
                } else {
                    $('#select-classroom').hide();
                    $('#select-student').hide();
                }
            });

            // Handle Classroom Selection Toggle
            $('#input-select-classroom').on('change', function () {
                if ($(this).is(':checked')) {
                    const unit = $('#unit').val();
                    if (unit) {
                        $('#table-select-classroom').show();
                        getClassroom(unit);
                    }
                } else {
                    $('#table-select-classroom').hide();
                    $('#select-student').hide();
                }
            });

            // Handle Check All Classrooms
            $(document).on('click', '#classroom-checks', function () {
                const isChecked = $(this).is(':checked');
                $('.classroom-check').prop('checked', isChecked);
                checkSelectedClassrooms();
            });

            // Handle Individual Classroom Check
            $(document).on('change', '.classroom-check', function () {
                const totalCheckboxes = $('.classroom-check').length;
                const checkedCheckboxes = $('.classroom-check:checked').length;
                $('#classroom-checks').prop('checked', totalCheckboxes === checkedCheckboxes);
                checkSelectedClassrooms();
            });

            // Handle Student Selection Toggle
            $('#input-select-student').on('change', function () {
                if ($(this).is(':checked')) {
                    const classrooms = getSelectedClassrooms();
                    if (classrooms.length > 0) {
                        $('#table-select-student').show();
                        getStudent(classrooms);
                    }
                } else {
                    $('#table-select-student').hide();
                }
            });

            // Handle Check All Students
            $(document).on('click', '#student-checks', function () {
                const isChecked = $(this).is(':checked');
                $('.student-check').prop('checked', isChecked);
            });

            // Handle Individual Student Check
            $(document).on('change', '.student-check', function () {
                const totalCheckboxes = $('.student-check').length;
                const checkedCheckboxes = $('.student-check:checked').length;
                $('#student-checks').prop('checked', totalCheckboxes === checkedCheckboxes);
            });

            // Check Selected Classrooms
            function checkSelectedClassrooms() {
                const classrooms = getSelectedClassrooms();

                if (classrooms.length > 0) {
                    $('#select-student').show();
                    if ($('#input-select-student').is(':checked')) {
                        getStudent(classrooms);
                    }
                } else {
                    $('#select-student').hide();
                }
            }

            // Get Selected Classrooms
            function getSelectedClassrooms() {
                const classrooms = [];
                $('.classroom-check:checked').each(function () {
                    classrooms.push($(this).val());
                });
                return classrooms;
            }

            // Get Classroom Data
            function getClassroom(unit) {
                $('#classroom-list').html(`
                    <tr>
                        <td colspan="7" class="text-center py-3">
                            <i class="fas fa-spinner fa-spin text-muted"></i>
                            <p class="mb-0 text-muted mt-2">Memuat data kelas...</p>
                        </td>
                    </tr>
                `);

                // Simulate data kelas
                setTimeout(function () {
                    const classrooms = [
                        { id: '63', code: '25/26-1A', name: 'Kelas 1A', year: '2025/2026', status: 'Aktif', students: 25 },
                        { id: '64', code: '25/26-1B', name: 'Kelas 1B', year: '2025/2026', status: 'Aktif', students: 24 },
                        { id: '65', code: '25/26-2A', name: 'Kelas 2A', year: '2025/2026', status: 'Aktif', students: 26 },
                        { id: '66', code: '25/26-2B', name: 'Kelas 2B', year: '2025/2026', status: 'Aktif', students: 23 }
                    ];

                    let html = '';
                    classrooms.forEach((classroom, index) => {
                        const checked = classroom.id === '63' ? 'checked' : '';
                        html += `
                            <tr>
                                <td class="align-middle text-center">
                                    <div class="d-flex justify-content-center align-items-center">
                                        <input type="checkbox" class="form-check-input classroom-check" 
                                               name="classrooms[]" value="${classroom.id}" 
                                               data-id="${classroom.id}" ${checked}
                                               style="cursor:pointer;margin:0;">
                                    </div>
                                </td>
                                <td class="text-center align-middle">${index + 1}</td>
                                <td class="align-middle">
                                    <span class="badge px-3 py-2" style="font-size:14px; font-weight:600;">
                                        ${classroom.code}
                                    </span>
                                </td>
                                <td class="align-middle"><strong>${classroom.name}</strong></td>
                                <td class="align-middle">${classroom.year}</td>
                                <td class="align-middle text-center">
                                    <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                                        <i class="fas fa-check-circle text-success mr-2"></i>${classroom.status}
                                    </span>
                                </td>
                                <td class="align-middle text-center">
                                    <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                                    <i class="fas fa-user-graduate text-info mr-2"></i>${classroom.students} Siswa
                                </span>
                                </td>
                            </tr>
                        `;
                    });

                    $('#classroom-list').html(html);
                    toggleClassroomBulkAction();

                    // Auto show student selection if default checked
                    if ($('.classroom-check:checked').length > 0) {
                        $('#select-student').show();
                        $('#input-select-student').prop('checked', true).trigger('change');
                    }
                }, 500);
            }

            // Get Student Data
            function getStudent(classrooms) {
                $('#student-list').html(`
                    <tr>
                        <td colspan="6" class="text-center py-3">
                            <i class="fas fa-spinner fa-spin text-muted"></i>
                            <p class="mb-0 text-muted mt-2">Memuat data siswa...</p>
                        </td>
                    </tr>
                `);

                // Simulate data siswa
                setTimeout(function () {
                    const students = [
                        { id: '156', number: '2025001', name: 'Ahmad Septian', class: 'Kelas 1A', status: 'Aktif' },
                        { id: '157', number: '2025002', name: 'Siti Rahmawati', class: 'Kelas 1A', status: 'Aktif' },
                        { id: '158', number: '2025003', name: 'Budi Prasetyo', class: 'Kelas 1A', status: 'Aktif' },
                        { id: '159', number: '2025004', name: 'Dewi Lestari', class: 'Kelas 1A', status: 'Aktif' },
                        { id: '160', number: '2025005', name: 'Eko Saputra', class: 'Kelas 1A', status: 'Aktif' },
                        { id: '161', number: '2025006', name: 'Fitri Handayani', class: 'Kelas 1B', status: 'Aktif' },
                        { id: '162', number: '2025007', name: 'Galih Pratama', class: 'Kelas 1B', status: 'Aktif' }
                    ];

                    let html = '';
                    students.forEach((student, index) => {
                        const checked = student.id === '156' ? 'checked' : '';
                        html += `
                            <tr>
                                <td class="align-middle text-center">
                                    <div class="d-flex justify-content-center align-items-center">
                                        <input type="checkbox" class="form-check-input student-check" 
                                               name="students[]" value="${student.id}" 
                                               data-id="${student.id}" ${checked}
                                               style="cursor:pointer;margin:0;">
                                    </div>
                                </td>
                                <td class="text-center align-middle">${index + 1}</td>
                                <td class="align-middle">
                                    <span class="badge px-2 py-1" style="background:#FFF3CD; color:#856404; border-radius:8px; font-size:12px; font-weight:600;">
                                        <i class="fas fa-id-card mr-1"></i>${student.number}
                                    </span>
                                </td>
                                <td class="align-middle"><strong>${student.name}</strong></td>
                                <td class="align-middle">${student.class}</td>
                                <td class="align-middle text-center">
                                    <span class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                                        <i class="fas fa-check-circle text-success mr-2"></i>${student.status}
                                    </span>
                                </td>
                            </tr>
                        `;
                    });

                    $('#student-list').html(html);
                    $('#student-checks').prop('checked', true);
                    toggleStudentBulkAction();
                }, 500);
            }

            // Form Validation
            function validateForm() {
                let isValid = true;
                const fields = {
                    'unit': 'Pilihan unit harus dipilih',
                    'bill-time': 'Jumlah periode tagihan harus dipilih',
                    'bill-month': 'Bulan mulai harus dipilih',
                    'bill-year': 'Tahun mulai harus dipilih',
                    'bill-category-1': 'Item tagihan 1 harus dipilih'
                };

                // Clear all feedback
                Object.keys(fields).forEach(field => {
                    $(`#${field}-feedback`).hide().text('');
                    $(`#${field}`).removeClass('is-invalid');
                });

                // Validate each field
                Object.keys(fields).forEach(field => {
                    const value = $(`#${field}`).val();
                    if (!value || value === '') {
                        isValid = false;
                        $(`#${field}-feedback`).show().text(fields[field]);
                        $(`#${field}`).addClass('is-invalid');
                    }
                });

                return isValid;
            }

            // Form Submit
            $('#form').on('submit', function (e) {
                e.preventDefault();

                if (!validateForm()) {
                    showAlert('Mohon lengkapi semua field yang wajib diisi', 'warning');
                    return;
                }

                // Show loading
                buttonActionHandler(true);

                // Get form data
                const formData = {
                    unit: $('#unit').val(),
                    classrooms: [],
                    students: [],
                    bill_time: $('#bill-time').val(),
                    bill_month: $('#bill-month').val(),
                    bill_year: $('#bill-year').val(),
                    bill_category_1: $('#bill-category-1').val(),
                    bill_category_2: $('#bill-category-2').val()
                };

                // Get selected classrooms
                $('.classroom-check:checked').each(function () {
                    formData.classrooms.push($(this).val());
                });

                // Get selected students
                $('.student-check:checked').each(function () {
                    formData.students.push($(this).val());
                });

                // Simulate AJAX request
                setTimeout(function () {
                    buttonActionHandler(false);

                    showAlert('Tagihan berhasil ditambahkan untuk ' +
                        formData.students.length + ' siswa', 'success');

                    // Reset form after 2 seconds
                    setTimeout(function () {
                        // Uncomment untuk redirect ke halaman tagihan
                        // window.location.href = 'Tagihan.html';
                    }, 2000);
                }, 1500);
            });

            // Button Action Handler
            function buttonActionHandler(isLoading) {
                const btnSubmit = $('#btn-submit');
                const btnIcon = $('#btn-icon');
                const btnSvg = $('#btn-svg');
                const btnText = $('#btn-text');

                if (isLoading) {
                    btnSubmit.prop('disabled', true);
                    btnSvg.hide();
                    btnIcon.show();
                    btnText.text('Memproses...');
                } else {
                    btnSubmit.prop('disabled', false);
                    btnIcon.hide();
                    btnSvg.show();
                    btnText.text('Proses Tambah Tagihan');
                }
            }

            // Auto trigger on load
            setTimeout(function () {
                $('#unit').trigger('change');
                $('#input-select-classroom').prop('checked', true).trigger('change');
            }, 300);
        });

        // Show Alert Function
        function showAlert(message, type) {
            const alert = $('#alert');
            const alertIcon = $('#alert-icon');
            const alertTitle = $('#alert-title');
            const alertContent = $('#alert-content');

            alertContent.html(message);

            // Remove all alert classes
            alert.removeClass('alert-success alert-warning alert-info alert-danger');

            if (type === 'success') {
                alert.addClass('alert-success');
                alertIcon.removeClass().addClass('fas fa-check-circle fa-2x text-success');
                alertTitle.text('Berhasil');
            } else if (type === 'warning') {
                alert.addClass('alert-warning');
                alertIcon.removeClass().addClass('fas fa-exclamation-circle fa-2x text-warning');
                alertTitle.text('Peringatan');
            } else if (type === 'info') {
                alert.addClass('alert-info');
                alertIcon.removeClass().addClass('fas fa-info-circle fa-2x text-info');
                alertTitle.text('Informasi');
            } else if (type === 'danger') {
                alert.addClass('alert-danger');
                alertIcon.removeClass().addClass('fas fa-times-circle fa-2x text-danger');
                alertTitle.text('Error');
            }

            alert.show().addClass('show');

            // Auto hide after 5 seconds
            setTimeout(function () {
                alert.removeClass('show');
                setTimeout(function () {
                    alert.hide();
                }, 150);
            }, 5000);
        }

        // Hide Alert Function
        function hideAlert() {
            $('#alert').removeClass('show');
            setTimeout(function () {
                $('#alert').hide();
            }, 150);
        }
    </script>

</body>

</html>