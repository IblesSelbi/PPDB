<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Sinkron Akun Siswa :: School Payment App</title>

    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
        }
    </style>
</head>

<body>

    <!-- NAVBAR -->
    <div id="navbar"></div>

    <!-- MAIN CONTENT -->
    <div class="container-fluid py-4">

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb bg-white px-3 mb-2">
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none">Beranda</a></li>
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none">Data Master</a></li>
                <li class="breadcrumb-item"><a href="DataAkun.html" class="text-decoration-none">Data Akun</a></li>
                <li class="breadcrumb-item active">Sinkron Akun</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="font-weight-bold mb-1">Sinkron Akun Siswa</h2>
                <p class="text-muted mb-0"><i class="fas fa-info-circle mr-1"></i>Sinkronisasi akun siswa secara
                    otomatis berdasarkan data kelas</p>
            </div>
            <a href="DataAkun.html" class="btn btn-outline-primary px-3">
                <i class="fas fa-arrow-left mr-2"></i>Kembali
            </a>
        </div>

        <!-- Alert -->
        <div id="alert" class="alert alert-dismissible fade" role="alert"
            style="display: none; border-left: 4px solid #216fcb;">
            <div class="d-flex align-items-center">
                <div class="mr-3">
                    <i id="alert-icon" class="fas fa-info-circle fa-2x text-primary"></i>
                </div>
                <div class="flex-grow-1">
                    <h6 id="alert-title" class="alert-heading font-weight-bold mb-1">Informasi</h6>
                    <div id="alert-content" class="mb-0"></div>
                </div>
            </div>
            <button type="button" class="close" onclick="hideAlert()">
                <span>&times;</span>
            </button>
        </div>

        <!-- Main Card -->
        <div class="card mb-4 shadow-sm border-0" style="border-radius: 12px;">
            <div class="card-body p-4">
                <div class="row">
                    <!-- Form Section -->
                    <div class="col-md-8">
                        <form id="form" action="javascript:void(0)">

                            <!-- Pilih Kelas -->
                            <div class="mb-4">
                                <label class="form-label font-weight-bold">
                                    <i class="fas fa-school text-primary mr-1"></i>Pilih Kelas
                                </label>
                                <select name="classroom" id="classroom" class="custom-select border-primary">
                                    <option value="">-- Pilih Kelas --</option>
                                    <option value="ALL">SEMUA KELAS</option>
                                </select>
                                <small class="form-text text-muted">Pilih kelas untuk menampilkan daftar siswa</small>
                                <small id="classroom-feedback" class="text-danger font-weight-medium"
                                    style="display: none;"></small>
                            </div>

                            <!-- Student Selection Table -->
                            <div id="select-student" class="mb-4" style="display: none;">
                                <label class="form-label font-weight-bold">
                                    <i class="fas fa-users text-primary mr-1"></i>Pilih Siswa
                                </label>

                                <!-- Table Header (Fixed) -->
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover table-bordered mb-0">
                                        <thead class="bg-light" style="border-bottom: 2px solid #e3e6f0;">
                                            <tr>
                                                <th class="text-center align-middle" style="width: 50px;">
                                                    <input type="checkbox" id="checks" class="form-check-input"
                                                        style="cursor: pointer;">
                                                </th>
                                                <th class="align-middle" style="width: 50px;">#</th>
                                                <th class="align-middle">Nomor Induk</th>
                                                <th class="align-middle">Nama Lengkap</th>
                                                <th class="text-center align-middle" style="width: 100px;">Status</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>

                                <!-- Table Body (Scrollable) -->
                                <div class="border"
                                    style="max-height: 400px; overflow-y: auto; border-radius: 0 0 8px 8px;">
                                    <table class="table table-sm table-hover mb-0">
                                        <tbody id="student-list">
                                            <tr>
                                                <td colspan="5" class="text-center text-muted py-4">
                                                    <i class="fas fa-users fa-2x mb-2 d-block"
                                                        style="opacity: 0.3;"></i>
                                                    <p class="mb-0">Pilih kelas untuk menampilkan daftar siswa</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <small class="form-text text-muted mt-2">
                                    <i class="fas fa-info-circle mr-1"></i>Centang siswa yang akan disinkronkan akunnya
                                </small>
                            </div>

                            <!-- Account Name Settings -->
                            <div class="card mb-4 border-0" style="background: #f8f9fa;">
                                <div class="card-body">
                                    <h6 class="font-weight-bold mb-3">
                                        <i class="fas fa-user-cog text-primary mr-2"></i>Pengaturan Nama Akun
                                    </h6>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" name="user_number" id="user-number"
                                            class="custom-control-input">
                                        <label class="custom-control-label" for="user-number">
                                            Jadikan nomor induk siswa sebagai nama akun (username)
                                        </label>
                                    </div>
                                    <small class="form-text text-muted ml-4">
                                        Jika dicentang, nomor induk siswa akan digunakan sebagai username untuk login
                                    </small>
                                </div>
                            </div>

                            <!-- Password Settings -->
                            <div class="card mb-4 border-0" style="background: #f8f9fa;">
                                <div class="card-body">
                                    <h6 class="font-weight-bold mb-3">
                                        <i class="fas fa-key text-primary mr-2"></i>Pengaturan Kata Sandi
                                    </h6>

                                    <!-- Password Input -->
                                    <div class="form-group">
                                        <label class="font-weight-medium">Kata Sandi Default</label>
                                        <div class="input-group">
                                            <input type="text" name="pass_set" id="pass-set" class="form-control"
                                                placeholder="Masukkan password default" value="L4IAiSetq">
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-secondary" type="button"
                                                    id="generate-password">
                                                    <i class="fas fa-sync-alt"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <small class="form-text text-muted">
                                            Password ini akan digunakan untuk semua akun yang disinkronkan
                                        </small>
                                    </div>

                                    <!-- Use Birthdate as Password -->
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" name="pass_date" id="pass-date"
                                            class="custom-control-input">
                                        <label class="custom-control-label" for="pass-date">
                                            Jadikan tanggal lahir siswa sebagai kata sandi akun
                                        </label>
                                    </div>
                                    <small class="form-text text-muted ml-4">
                                        Format: ddmmyyyy (contoh: 15012010 untuk tanggal 15 Januari 2010)
                                    </small>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="row">
                                <div class="col-md-6">
                                    <button type="submit" id="btn-submit"
                                        class="btn btn-primary btn-block font-weight-bold shadow-sm">
                                        <i id="btn-icon" class="fas fa-sync mr-2"></i>
                                        <span id="btn-spinner" class="spinner-border spinner-border-sm mr-2"
                                            style="display: none;"></span>
                                        <span id="btn-text">Proses Sinkronisasi</span>
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <button type="reset" class="btn btn-outline-secondary btn-block font-weight-bold">
                                        <i class="fas fa-redo mr-2"></i>Reset Form
                                    </button>
                                </div>
                            </div>

                        </form>
                    </div>

                    <!-- Info Section -->
                    <div class="col-md-4">
                        <div class="alert alert-info border-0 mb-3" style="background: #e3f2fd; border-radius: 10px;">
                            <h6 class="font-weight-bold text-primary mb-2">
                                <i class="fas fa-info-circle mr-1"></i>Informasi Sinkronisasi
                            </h6>
                            <ul class="mb-0 pl-3" style="font-size: 0.9rem;">
                                <li class="mb-2">Pilih kelas atau semua kelas untuk sinkronisasi</li>
                                <li class="mb-2">Centang siswa yang akan dibuatkan akun</li>
                                <li class="mb-2">Atur nama akun dan kata sandi</li>
                                <li class="mb-2">Proses sinkronisasi akan membuat akun otomatis</li>
                            </ul>
                        </div>

                        <div class="alert alert-warning border-0" style="background: #fff3cd; border-radius: 10px;">
                            <h6 class="font-weight-bold text-warning mb-2">
                                <i class="fas fa-exclamation-triangle mr-1"></i>Perhatian
                            </h6>
                            <ul class="mb-0 pl-3" style="font-size: 0.9rem;">
                                <li class="mb-2">Pastikan data siswa sudah benar</li>
                                <li class="mb-2">Akun yang sudah ada tidak akan dibuat ulang</li>
                                <li class="mb-2">Simpan data nama akun dan password dengan aman</li>
                            </ul>
                        </div>

                        <div class="card border-0 shadow-sm">
                            <div class="card-body text-center">
                                <i class="fas fa-sync-alt fa-3x text-primary mb-3"></i>
                                <h6 class="font-weight-bold">Sinkronisasi Cepat</h6>
                                <p class="text-muted small mb-0">Buat akun untuk banyak siswa sekaligus dengan
                                    pengaturan yang sama</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Loading Modal -->
    <div class="modal fade" id="load-dialog" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                    <p class="text-muted mb-0">Sedang memuat data...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirm-dialog" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title font-weight-bold">Konfirmasi Sinkronisasi</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body text-center py-4">
                    <i class="fas fa-question-circle fa-4x text-warning mb-3"></i>
                    <h5 class="font-weight-bold mb-2">Proses Sinkronisasi Akun</h5>
                    <p class="text-muted mb-0">
                        Apakah Anda yakin akan memproses sinkronisasi akun siswa?
                        Proses ini akan membuat akun baru untuk siswa yang belum memiliki akun.
                    </p>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        <i class="fas fa-times mr-1"></i>Batalkan
                    </button>
                    <button type="button" id="btn-confirm" class="btn btn-primary">
                        <i class="fas fa-check mr-1"></i>Ya, Proses
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="success-dialog" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                    <h4 class="font-weight-bold mb-2">Sinkronisasi Berhasil</h4>
                    <p class="text-muted mb-0">Akun siswa berhasil disinkronkan ke sistem</p>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">
                        <i class="fas fa-check mr-1"></i>OK
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white py-3 mt-5">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0 text-muted">Powered By School Payment App &copy; 2022-2025</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

    <script>
        fetch("../Navbar/navbar.html")
            .then(res => res.text())
            .then(html => {
                const navbar = document.getElementById("navbar");
                navbar.innerHTML = html;

                // Menjalankan ulang semua script yang ada di navbar.html
                navbar.querySelectorAll("script").forEach(oldScript => {
                    const newScript = document.createElement("script");
                    if (oldScript.src) {
                        newScript.src = oldScript.src;
                    } else {
                        newScript.innerHTML = oldScript.innerHTML;
                    }
                    document.body.appendChild(newScript);
                });

                // PANGGIL FUNGSI ACTIVE STATE SETELAH NAVBAR LOADED
                // Tunggu 200ms untuk memastikan semua script navbar selesai
                setTimeout(function () {
                    setActiveNavbar();
                }, 200);
            });

        // JavaScript akan ditambahkan pada tahap berikutnya
        console.log('SinkronAkun.html loaded successfully');

        // Preview: Toggle password field based on checkbox
        $('#pass-date').on('change', function () {
            if ($(this).is(':checked')) {
                $('#pass-set').prop('disabled', true).addClass('bg-light');
            } else {
                $('#pass-set').prop('disabled', false).removeClass('bg-light');
            }
        });

        // Preview: Check/Uncheck all students
        $('#checks').on('change', function () {
            $('.check').prop('checked', $(this).is(':checked'));
        });

        // Preview: Generate random password
        $('#generate-password').on('click', function () {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let password = '';
            for (let i = 0; i < 9; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            $('#pass-set').val(password);
        });

        // Preview: Show select-student when classroom is selected
        $('#classroom').on('change', function () {
            if ($(this).val() !== '') {
                $('#select-student').slideDown();
            } else {
                $('#select-student').slideUp();
            }
        });

        // Alert functions
        function showAlert(message, type) {
            const alertTypes = {
                'success': { icon: 'fa-check-circle', color: 'text-success', bg: 'alert-success' },
                'warning': { icon: 'fa-exclamation-triangle', color: 'text-warning', bg: 'alert-warning' },
                'danger': { icon: 'fa-times-circle', color: 'text-danger', bg: 'alert-danger' },
                'info': { icon: 'fa-info-circle', color: 'text-info', bg: 'alert-info' }
            };

            const alertType = alertTypes[type] || alertTypes['info'];

            $('#alert').removeClass('alert-success alert-warning alert-danger alert-info')
                .addClass(alertType.bg + ' show')
                .css('display', 'block');
            $('#alert-icon').removeClass().addClass('fas ' + alertType.icon + ' fa-2x ' + alertType.color);
            $('#alert-title').text(type.charAt(0).toUpperCase() + type.slice(1));
            $('#alert-content').html(message);
        }

        function hideAlert() {
            $('#alert').removeClass('show').fadeOut();
        }
    </script>

</body>

</html>