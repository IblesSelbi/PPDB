<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Data Pendaftar Dihapus :: PPDB</title>

    <!-- Bootstrap 4 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
</head>

<style>
    body {
        font-family: "Inter", sans-serif;
        background-color: #f5f5f5;
    }
</style>

<body>
    <!-- NAVBAR -->
    <div id="navbar"></div>

    <div class="container-fluid py-4">
        <!-- HEADER -->
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb bg-white px-3 mb-2">
                <li class="breadcrumb-item">
                    <a href="DataPendaftar.html" class="text-decoration-none">PPDB</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="DataPendaftar.html" class="text-decoration-none">Data Pendaftar</a>
                </li>
                <li class="breadcrumb-item active">Dihapus</li>
            </ol>
        </nav>

        <div class="bg-white shadow-sm rounded p-4 mb-4 border-left border-danger">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
                <div class="mb-3 mb-md-0">
                    <h2 class="font-weight-bold text-danger mb-2">
                        Data Pendaftar Dihapus
                    </h2>
                    <p class="text-muted mb-0">
                        <i class="fas fa-info-circle mr-1 text-info"></i>Kelola data
                        pendaftar yang telah dihapus. Anda dapat memulihkan atau menghapus
                        permanen data ini.
                    </p>
                </div>
                <a href="DataPendaftar.html" class="btn btn-outline-primary font-weight-bold">
                    <i class="fas fa-arrow-left mr-2"></i>Kembali
                </a>
            </div>
        </div>

        <!-- FILTER -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white d-flex justify-content-between align-items-center py-3"
                data-toggle="collapse" data-target="#filterCollapse" style="cursor: pointer">
                <h5 class="mb-0 font-weight-bold text-primary d-flex align-items-center">
                    <i class="fas fa-filter mr-2 text-success"></i>Filter Data
                </h5>
                <i class="fas fa-chevron-down text-dark" id="filterIcon"></i>
            </div>
            <div id="filterCollapse" class="collapse show">
                <div class="card-body bg-light">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label class="small font-weight-bold">Kata Kunci</label>
                            <input type="text" class="form-control" id="keywordSearch"
                                placeholder="Cari berdasarkan nama atau nomor pendaftaran" />
                        </div>
                    </div>
                    <button class="btn btn-success px-4 mr-2" id="btnTerapkanFilter">
                        <i class="fas fa-search mr-2"></i>Terapkan Filter
                    </button>
                    <button class="btn btn-outline-secondary px-4" id="btnResetFilter">
                        <i class="fas fa-redo mr-2"></i>Reset
                    </button>
                </div>
            </div>
        </div>

        <!-- AKSI MASAL -->
        <div class="mb-3" id="bulkActions" style="display: none">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-info" id="btnBulkRestore">
                    <i class="fas fa-undo mr-2"></i>Pulihkan Data Terpilih
                </button>
                <button type="button" class="btn btn-danger" id="btnBulkDelete">
                    <i class="fas fa-trash-alt mr-2"></i>Hapus Permanen Terpilih
                </button>
            </div>
        </div>

        <!-- TABEL -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="font-weight-bold mb-0">
                    <i class="fas fa-trash-restore text-danger mr-2"></i>Daftar Data
                    Dihapus
                </h5>
                <span class="badge badge-danger badge-pill" id="totalData">Total: 3 data</span>
            </div>
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="thead-light">
                        <tr>
                            <th class="text-center align-middle" style="width: 75px">
                                <div class="d-flex justify-content-center align-items-center">
                                    <input type="checkbox" id="checkAll" class="form-check-input m-0" />
                                </div>
                            </th>
                            <th style="width: 50px">#</th>
                            <th>Nama Unit</th>
                            <th>No. Pendaftaran</th>
                            <th>Nama Lengkap</th>
                            <th>Jenis Kelamin</th>
                            <th>Waktu Pendaftaran</th>
                            <th>Status</th>
                            <th>Waktu Dihapus</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data Dummy 1 -->
                        <tr data-id="1" data-nama="AHMAD FAUZI" data-no="2526-0005">
                            <td class="text-center align-middle">
                                <div class="d-flex justify-content-center align-items-center">
                                    <input type="checkbox" class="form-check-input row-check m-0" data-id="1" />
                                </div>
                            </td>
                            <td class="align-middle">1</td>
                            <td class="align-middle">
                                <span class="badge badge-info badge-pill px-3 py-2">SMP</span>
                            </td>
                            <td class="text-primary align-middle">
                                <strong>2526-0005</strong>
                            </td>
                            <td class="align-middle">
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mr-2 font-weight-bold"
                                        style="width: 35px; height: 35px">
                                        AF
                                    </div>
                                    <div>
                                        <strong>Ahmad Fauzi</strong>
                                        <small class="d-block text-muted">081234567890</small>
                                    </div>
                                </div>
                            </td>
                            <td class="align-middle">Laki-laki</td>
                            <td class="align-middle">
                                <small class="text-muted"><i class="far fa-clock mr-1"></i>15 Jan 2025, 10:30</small>
                            </td>
                            <td class="align-middle">
                                <span
                                    class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                                    <i class="fas fa-clock text-danger mr-2"></i>Menunggu
                                    Pembayaran
                                </span>
                            </td>
                            <td class="align-middle">
                                <small class="text-danger"><i class="far fa-trash-alt mr-1"></i>05 Feb 2025,
                                    14:20</small>
                            </td>
                            <td class="align-middle">
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-info btn-restore" data-id="1" title="Pulihkan">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-delete" data-id="1"
                                        title="Hapus Permanen">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <!-- Data Dummy 2 -->
                        <tr data-id="2" data-nama="SITI NURHALIZA" data-no="2526-0003">
                            <td class="text-center align-middle">
                                <div class="d-flex justify-content-center align-items-center">
                                    <input type="checkbox" class="form-check-input row-check m-0" data-id="2" />
                                </div>
                            </td>
                            <td class="align-middle">2</td>
                            <td class="align-middle">
                                <span class="badge badge-primary badge-pill px-3 py-2">SMA</span>
                            </td>
                            <td class="text-primary align-middle">
                                <strong>2526-0003</strong>
                            </td>
                            <td class="align-middle">
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle bg-info text-white d-flex align-items-center justify-content-center mr-2 font-weight-bold"
                                        style="width: 35px; height: 35px">
                                        SN
                                    </div>
                                    <div>
                                        <strong>Siti Nurhaliza</strong>
                                        <small class="d-block text-muted">081234567890</small>
                                    </div>
                                </div>
                            </td>
                            <td class="align-middle">Perempuan</td>
                            <td class="align-middle">
                                <small class="text-muted"><i class="far fa-clock mr-1"></i>12 Jan 2025, 09:15</small>
                            </td>
                            <td class="align-middle">
                                <span
                                    class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                                    <i class="fas fa-clock text-info mr-2"></i>Menunggu
                                    verifikasi
                                </span>
                            </td>
                            <td class="align-middle">
                                <small class="text-danger"><i class="far fa-trash-alt mr-1"></i>04 Feb 2025,
                                    11:45</small>
                            </td>
                            <td class="align-middle">
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-info btn-restore" data-id="2" title="Pulihkan">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-delete" data-id="2"
                                        title="Hapus Permanen">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <!-- Data Dummy 3 -->
                        <tr data-id="3" data-nama="BUDI SANTOSO" data-no="2526-0001">
                            <td class="text-center align-middle">
                                <div class="d-flex justify-content-center align-items-center">
                                    <input type="checkbox" class="form-check-input row-check m-0" data-id="3" />
                                </div>
                            </td>
                            <td class="align-middle">3</td>
                            <td class="align-middle">
                                <span class="badge badge-danger badge-pill px-3 py-2">SD</span>
                            </td>
                            <td class="text-primary align-middle">
                                <strong>2526-0001</strong>
                            </td>
                            <td class="align-middle">
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle bg-warning text-white d-flex align-items-center justify-content-center mr-2 font-weight-bold"
                                        style="width: 35px; height: 35px">
                                        BS
                                    </div>
                                    <div>
                                        <strong>Budi Santoso</strong>
                                        <small class="d-block text-muted">081234567890</small>
                                    </div>
                                </div>
                            </td>
                            <td class="align-middle">Laki-laki</td>
                            <td class="align-middle">
                                <small class="text-muted"><i class="far fa-clock mr-1"></i>10 Jan 2025, 08:00</small>
                            </td>
                            <td class="align-middle">
                                <span
                                    class="badge badge-light d-inline-flex align-items-center px-3 py-2 rounded shadow-sm">
                                    <i class="fas fa-clock text-danger mr-2"></i>Menunggu
                                    Pembayaran
                                </span>
                            </td>
                            <td class="align-middle">
                                <small class="text-danger"><i class="far fa-trash-alt mr-1"></i>03 Feb 2025,
                                    16:30</small>
                            </td>
                            <td class="align-middle">
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-info btn-restore" data-id="3" title="Pulihkan">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-delete" data-id="3"
                                        title="Hapus Permanen">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Konfirmasi Pulihkan -->
    <div class="modal fade" id="restoreModal" data-backdrop="static" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <i class="fas fa-info-circle text-info" style="font-size: 48px"></i>
                    <h5 class="mt-3 font-weight-bold">Konfirmasi Pulihkan Data</h5>
                    <p class="text-muted mb-4">
                        Apakah Anda yakin akan memulihkan data pendaftar yang dipilih?
                    </p>
                    <div class="d-flex justify-content-center">
                        <button type="button" class="btn btn-secondary mr-2" data-dismiss="modal">
                            <i class="fas fa-times mr-2"></i>Batalkan
                        </button>
                        <button type="button" class="btn btn-info" id="btnConfirmRestore">
                            <i class="fas fa-check mr-2" id="iconRestore"></i>
                            <span class="spinner-border spinner-border-sm mr-2" id="spinnerRestore"
                                style="display: none"></span>
                            Konfirmasi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Konfirmasi Hapus Permanen -->
    <div class="modal fade" id="deleteModal" data-backdrop="static" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <i class="fas fa-exclamation-triangle text-danger" style="font-size: 48px"></i>
                    <h5 class="mt-3 font-weight-bold text-danger">
                        Konfirmasi Hapus Permanen
                    </h5>
                    <p class="text-muted mb-2">
                        Apakah Anda yakin akan menghapus data pendaftar yang dipilih
                        secara permanen? Data yang telah dihapus tidak dapat dikembalikan.
                    </p>
                    <div class="alert alert-warning text-left">
                        <strong><i class="fas fa-exclamation-circle mr-2"></i>PENTING!</strong><br />
                        Seluruh data yang mereferensikan ke data pendaftar seperti data
                        transaksi pembayaran akan menjadi tidak memiliki nilai pendaftar.
                    </div>
                    <div class="d-flex justify-content-center mt-3">
                        <button type="button" class="btn btn-secondary mr-2" data-dismiss="modal">
                            <i class="fas fa-times mr-2"></i>Batalkan
                        </button>
                        <button type="button" class="btn btn-danger" id="btnConfirmDelete">
                            <i class="fas fa-check mr-2" id="iconDelete"></i>
                            <span class="spinner-border spinner-border-sm mr-2" id="spinnerDelete"
                                style="display: none"></span>
                            Konfirmasi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Loading -->
    <div class="modal fade" id="loadingModal" data-backdrop="static" data-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                    <p class="mb-0 text-muted">Sedang memproses data...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white py-3 mt-5">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0 text-muted">Powered By PPDB &copy; 2022-2025</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        fetch("../Navbar/navbar.html")
            .then(res => res.text())
            .then(html => {
                const navbar = document.getElementById("navbar");
                navbar.innerHTML = html;

                // Menjalankan ulang semua script yang ada di navbar.html
                navbar.querySelectorAll("script").forEach(oldScript => {
                    const newScript = document.createElement("script");
                    if (oldScript.src) {
                        newScript.src = oldScript.src;
                    } else {
                        newScript.innerHTML = oldScript.innerHTML;
                    }
                    document.body.appendChild(newScript);
                });

                // PANGGIL FUNGSI ACTIVE STATE SETELAH NAVBAR LOADED
                // Tunggu 200ms untuk memastikan semua script navbar selesai
                setTimeout(function () {
                    setActiveNavbar();
                }, 200);
            });

        let selectedIds = [];

        // Check all checkbox
        document
            .getElementById("checkAll")
            .addEventListener("change", function () {
                const checkboxes = document.querySelectorAll(".row-check");
                checkboxes.forEach((cb) => (cb.checked = this.checked));
                updateBulkActions();
            });

        // Update bulk actions visibility
        document.addEventListener("change", function (e) {
            if (e.target.classList.contains("row-check")) {
                updateBulkActions();
            }
        });

        function updateBulkActions() {
            const checked = document.querySelectorAll(".row-check:checked");
            const bulkActions = document.getElementById("bulkActions");

            if (checked.length > 0) {
                bulkActions.style.display = "block";
                selectedIds = Array.from(checked).map((cb) =>
                    parseInt(cb.dataset.id)
                );
            } else {
                bulkActions.style.display = "none";
                selectedIds = [];
            }
        }

        // Filter functionality
        document
            .getElementById("btnTerapkanFilter")
            .addEventListener("click", function () {
                const keyword = document
                    .getElementById("keywordSearch")
                    .value.toLowerCase();
                const rows = document.querySelectorAll("#tableBody tr");
                let visibleCount = 0;

                rows.forEach((row) => {
                    const nama = row.getAttribute("data-nama").toLowerCase();
                    const noPendaftaran = row.getAttribute("data-no").toLowerCase();

                    if (
                        keyword &&
                        (nama.includes(keyword) || noPendaftaran.includes(keyword))
                    ) {
                        row.style.display = "";
                        visibleCount++;
                    } else if (!keyword) {
                        row.style.display = "";
                        visibleCount++;
                    } else {
                        row.style.display = "none";
                    }
                });

                document.getElementById(
                    "totalData"
                ).textContent = `Total: ${visibleCount} data`;
                document.getElementById("checkAll").checked = false;
                updateBulkActions();
            });

        // Reset filter
        document
            .getElementById("btnResetFilter")
            .addEventListener("click", function () {
                document.getElementById("keywordSearch").value = "";
                const rows = document.querySelectorAll("#tableBody tr");
                rows.forEach((row) => (row.style.display = ""));
                document.getElementById(
                    "totalData"
                ).textContent = `Total: ${rows.length} data`;
                document.getElementById("checkAll").checked = false;
                updateBulkActions();
            });

        // Pulihkan single data
        document.addEventListener("click", function (e) {
            if (e.target.closest(".btn-restore")) {
                const id = parseInt(e.target.closest(".btn-restore").dataset.id);
                selectedIds = [id];
                $("#restoreModal").modal("show");
            }
        });

        // Hapus permanen single data
        document.addEventListener("click", function (e) {
            if (e.target.closest(".btn-delete")) {
                const id = parseInt(e.target.closest(".btn-delete").dataset.id);
                selectedIds = [id];
                $("#deleteModal").modal("show");
            }
        });

        // Bulk restore
        document
            .getElementById("btnBulkRestore")
            .addEventListener("click", function () {
                if (selectedIds.length > 0) {
                    $("#restoreModal").modal("show");
                }
            });

        // Bulk delete
        document
            .getElementById("btnBulkDelete")
            .addEventListener("click", function () {
                if (selectedIds.length > 0) {
                    $("#deleteModal").modal("show");
                }
            });

        // Confirm restore
        document
            .getElementById("btnConfirmRestore")
            .addEventListener("click", function () {
                const btn = this;
                const icon = document.getElementById("iconRestore");
                const spinner = document.getElementById("spinnerRestore");

                btn.disabled = true;
                icon.style.display = "none";
                spinner.style.display = "inline-block";

                // Simulasi proses restore
                setTimeout(() => {
                    // Remove rows dari tabel
                    selectedIds.forEach((id) => {
                        const row = document.querySelector(`tr[data-id="${id}"]`);
                        if (row) {
                            row.remove();
                        }
                    });

                    // Update total
                    const remainingRows =
                        document.querySelectorAll("#tableBody tr").length;
                    document.getElementById(
                        "totalData"
                    ).textContent = `Total: ${remainingRows} data`;

                    // Reset
                    document.getElementById("checkAll").checked = false;
                    updateBulkActions();

                    // Reset button
                    btn.disabled = false;
                    icon.style.display = "inline-block";
                    spinner.style.display = "none";

                    // Close modal
                    $("#restoreModal").modal("hide");

                    // Success alert
                    showAlert(
                        "success",
                        `${selectedIds.length} data berhasil dipulihkan!`
                    );

                    selectedIds = [];
                }, 1500);
            });

        // Confirm delete
        document
            .getElementById("btnConfirmDelete")
            .addEventListener("click", function () {
                const btn = this;
                const icon = document.getElementById("iconDelete");
                const spinner = document.getElementById("spinnerDelete");

                btn.disabled = true;
                icon.style.display = "none";
                spinner.style.display = "inline-block";

                // Simulasi proses delete permanen
                setTimeout(() => {
                    // Remove rows dari tabel
                    selectedIds.forEach((id) => {
                        const row = document.querySelector(`tr[data-id="${id}"]`);
                        if (row) {
                            row.remove();
                        }
                    });

                    // Update total
                    const remainingRows =
                        document.querySelectorAll("#tableBody tr").length;
                    document.getElementById(
                        "totalData"
                    ).textContent = `Total: ${remainingRows} data`;

                    // Reset
                    document.getElementById("checkAll").checked = false;
                    updateBulkActions();

                    // Reset button
                    btn.disabled = false;
                    icon.style.display = "inline-block";
                    spinner.style.display = "none";

                    // Close modal
                    $("#deleteModal").modal("hide");

                    // Success alert
                    showAlert(
                        "danger",
                        `${selectedIds.length} data berhasil dihapus permanen!`
                    );

                    selectedIds = [];
                }, 1500);
            });

        // Show alert function
        function showAlert(type, message) {
            const alertDiv = document.createElement("div");
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                <strong><i class="fas fa-${type === "success" ? "check-circle" : "exclamation-triangle"
                } mr-2"></i>${type === "success" ? "Berhasil!" : "Perhatian!"
                }</strong> 
                ${message}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            `;
            document
                .querySelector(".container-fluid")
                .insertBefore(
                    alertDiv,
                    document.querySelector(".container-fluid").firstChild
                );

            // Auto dismiss after 5 seconds
            setTimeout(() => alertDiv.remove(), 5000);
        }

        // Toggle filter collapse icon
        $("#filterCollapse")
            .on("shown.bs.collapse", function () {
                document.getElementById("filterIcon").className = "fas fa-chevron-up";
            })
            .on("hidden.bs.collapse", function () {
                document.getElementById("filterIcon").className =
                    "fas fa-chevron-down";
            });
    </script>
</body>

</html>